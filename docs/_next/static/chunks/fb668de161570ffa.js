(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,58678,(e,t,n)=>{t.exports=e.r(80963)},43181,e=>{"use strict";e.s(["default",()=>O],43181);var t=e.i(91398),n=e.i(58678),a=e.i(91788),l=e.i(66402),s=e.i(85134),i=e.i(55824),o=e.i(43028),r=e.i(30943);function d(e){let{open:n,onClose:l,onConfirm:s,task:i,taskTitle:o}=e,[d,c]=(0,a.useState)(!1),[u,p]=(0,a.useState)("instance");if((0,a.useEffect)(()=>(c(!0),()=>c(!1)),[]),(0,a.useEffect)(()=>{n&&i&&("oneoff"===i.type?p("template"):p("instance"))},[n,i]),!n||!d||!i)return null;let m="oneoff"===i.type||i.oneOff,h=o||i.title||"Task",f=(0,t.jsx)("div",{className:"modal-overlay",onClick:l,children:(0,t.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h2",{children:"Delete Task"}),(0,t.jsx)("span",{className:"close",onClick:e=>{e.stopPropagation(),l()},children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("p",{children:["What would you like to delete for ",(0,t.jsx)("strong",{children:h}),"?"]}),m?(0,t.jsx)("div",{className:"delete-options",children:(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"deleteOption",value:"template",checked:"template"===u,onChange:()=>p("template")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Delete this task"}),(0,t.jsx)("p",{className:"option-description",children:"Remove the task completely (one-off tasks are deleted entirely)"})]})]})}):(0,t.jsxs)("div",{className:"delete-options",children:[(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"deleteOption",value:"instance",checked:"instance"===u,onChange:()=>p("instance")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Delete just this occurrence"}),(0,t.jsx)("p",{className:"option-description",children:"Remove only this instance. Future occurrences will still be generated."})]})]}),(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"deleteOption",value:"future",checked:"future"===u,onChange:()=>p("future")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Delete all future occurrences"}),(0,t.jsx)("p",{className:"option-description",children:"Stop generating new instances, but keep past completed instances."})]})]}),(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"deleteOption",value:"template",checked:"template"===u,onChange:()=>p("template")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Delete task template entirely"}),(0,t.jsx)("p",{className:"option-description",children:"Remove the task completely for all children and all dates (past and future)."})]})]})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{s(u),l()},children:"Delete"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:l,children:"Cancel"})]})]})});return(0,r.createPortal)(f,document.body)}function c(e){let{open:n,onClose:l,onConfirm:s,task:i,taskTitle:o}=e,[d,c]=(0,a.useState)(!1),[u,p]=(0,a.useState)("instance");if((0,a.useEffect)(()=>(c(!0),()=>c(!1)),[]),(0,a.useEffect)(()=>{n&&i&&("oneoff"===i.type?p("template"):p("instance"))},[n,i]),!n||!d||!i)return null;let m="oneoff"===i.type||i.oneOff,h=o||i.title||"Task",f=(0,t.jsx)("div",{className:"modal-overlay",onClick:l,children:(0,t.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h2",{children:"Edit Task"}),(0,t.jsx)("span",{className:"close",onClick:e=>{e.stopPropagation(),l()},children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("p",{children:["What would you like to edit for ",(0,t.jsx)("strong",{children:h}),"?"]}),m?(0,t.jsx)("div",{className:"delete-options",children:(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"editOption",value:"template",checked:"template"===u,onChange:()=>p("template")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Edit this task"}),(0,t.jsx)("p",{className:"option-description",children:"Modify the task completely (one-off tasks are edited entirely)"})]})]})}):(0,t.jsxs)("div",{className:"delete-options",children:[(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"editOption",value:"instance",checked:"instance"===u,onChange:()=>p("instance")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Edit just this occurrence"}),(0,t.jsx)("p",{className:"option-description",children:"Modify only this instance. Future occurrences will remain unchanged."})]})]}),(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"editOption",value:"future",checked:"future"===u,onChange:()=>p("future")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Edit all future occurrences"}),(0,t.jsx)("p",{className:"option-description",children:"Apply changes to all future instances, but keep past instances unchanged."})]})]}),(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"editOption",value:"template",checked:"template"===u,onChange:()=>p("template")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Edit task template entirely"}),(0,t.jsx)("p",{className:"option-description",children:"Modify the task template, affecting all instances (past and future)."})]})]})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{s(u),l()},children:"Continue"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:l,children:"Cancel"})]})]})});return(0,r.createPortal)(f,document.body)}function u(e){let{startedAt:n,allowedSeconds:l,size:s=32}=e,[i,o]=a.default.useState(()=>Date.now());a.default.useEffect(()=>{let e=setInterval(()=>o(Date.now()),1e3);return()=>clearInterval(e)},[]);let r=Math.max(0,Math.floor((i-new Date(n).getTime())/1e3)),d=(s-4)/2,c=2*Math.PI*d,u=c*Math.min(Math.max(r/l,0),1),p=r>l?Math.min((r-l)/l,1):0,m=c*p;return(0,t.jsx)("div",{style:{width:s,height:s,display:"inline-block"},"aria-hidden":!0,children:(0,t.jsx)("svg",{width:s,height:s,viewBox:"0 0 ".concat(s," ").concat(s),children:(0,t.jsxs)("g",{transform:"translate(".concat(s/2,", ").concat(s/2,")"),children:[(0,t.jsx)("circle",{r:d,cx:0,cy:0,fill:"none",stroke:"#eef2ff",strokeWidth:3}),(0,t.jsx)("circle",{r:d,cx:0,cy:0,fill:"none",stroke:"#3b82f6",strokeWidth:3,strokeLinecap:"round",strokeDasharray:"".concat(u," ").concat(c-u),transform:"rotate(-90)"}),p>0&&(0,t.jsx)("circle",{r:d,cx:0,cy:0,fill:"none",stroke:"#ef4444",strokeWidth:3,strokeLinecap:"round",strokeDasharray:"".concat(m," ").concat(c-m),transform:"scale(-1,1) rotate(-90)"}),(0,t.jsx)("text",{x:0,y:4,textAnchor:"middle",fontSize:10,fill:p>0?"#ef4444":"#1f2937",style:{fontFamily:"monospace"},children:function(e){let t=Math.abs(Math.round(e)),n=Math.floor(t/60).toString().padStart(2,"0"),a=(t%60).toString().padStart(2,"0");return"".concat(e<0?"-":"").concat(n,":").concat(a)}(l-r)})]})})})}let p=function(e,t){let{state:n,dispatch:s}=(0,l.useChoresApp)(),i=(0,a.useMemo)(()=>{if(!e||!n.timers)return;let a=Object.values(n.timers).find(n=>n.taskKey===e&&n.childId===t);return a?{id:a.id,taskKey:a.taskKey,childId:a.childId,startedAt:a.startedAt,allowedSeconds:a.allowedSeconds}:void 0},[n.timers,e,t]),o=(0,a.useCallback)(()=>{if(!e||null==t||i)return;let a=300;if(e.includes(":"));else{let t=e.split("-");if(t.length>=2){var l;let e=t.length>=5?t.slice(1,-3).join("-"):t.slice(1).join("-"),s=n.tasks.find(t=>t.id===e);(null==s||null==(l=s.timed)?void 0:l.allowedSeconds)&&(a=s.timed.allowedSeconds)}}s({type:"START_TIMER",payload:{timer:{id:"t_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,8)),taskKey:e,childId:t,startedAt:new Date().toISOString(),allowedSeconds:a}}})},[e,t,s,i,n.tasks]),r=(0,a.useCallback)(()=>{i&&s({type:"STOP_TIMER",payload:{timerId:i.id,stoppedAt:new Date().toISOString()}})},[i,s]),d=(0,a.useMemo)(()=>{if(!i)return!1;let e=new Date(i.startedAt).getTime();return Date.now()-e>=5e3},[i]);return{activeTimer:i,start:o,stop:r,canStopNow:d}},m={enabled:!0,volume:1,rate:1,pitch:1};function h(e){let t={...m,...e},n=(0,a.useRef)(null),l=(0,a.useCallback)((e,a)=>{if(!("speechSynthesis"in window))return void console.warn("Speech synthesis not supported in this browser");let l={...t,...a};if(!l.enabled)return;n.current&&window.speechSynthesis.cancel();let s=new SpeechSynthesisUtterance(e);if(s.volume=Math.max(0,Math.min(1,l.volume)),s.rate=Math.max(.1,Math.min(10,l.rate)),s.pitch=Math.max(0,Math.min(2,l.pitch)),l.voice){let e=window.speechSynthesis.getVoices().find(e=>e.name===l.voice);e&&(s.voice=e)}n.current=s,window.speechSynthesis.speak(s),s.onend=()=>{n.current=null},s.onerror=e=>{console.error("Speech synthesis error:",e),n.current=null}},[t]);return{speak:l,cancel:(0,a.useCallback)(()=>{"speechSynthesis"in window&&(window.speechSynthesis.cancel(),n.current=null)},[]),isSpeaking:(0,a.useCallback)(()=>window.speechSynthesis.speaking,[])}}let f={enabled:!1,volume:1,rate:1,pitch:1,announceAtPercentages:[.5,.75,.9],announceAtSecondsRemaining:[60,30,10],announceAtStart:!0,messageFormat:"{childName}, time to start {taskTitle}!"},g=function(e,t,n,l){let s={...f,...l},{speak:i}=h(s),o=(0,a.useRef)(new Set),r=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!e||!t||!s.enabled){o.current.clear(),r.current&&(clearInterval(r.current),r.current=null);return}let a=new Date(e.startedAt).getTime(),l=e.allowedSeconds,d=t.title||"your task",c=e=>{let t=Math.floor(e/60),n=e%60;return t>0?"".concat(t," minute").concat(1!==t?"s":""," and ").concat(n," second").concat(1!==n?"s":""):"".concat(n," second").concat(1!==n?"s":"")},u=(e,t,a)=>{let l=e.replace(/{taskTitle}/g,d).replace(/{childName}/g,n);return void 0!==t&&(l=l.replace(/{remaining}/g,c(t))),void 0!==a&&(l=l.replace(/{elapsed}/g,c(a))),l};if(s.announceAtStart){let e="start";o.current.has(e)||(i(u(s.messageFormat||"{childName}, time to start {taskTitle}!")),o.current.add(e))}return r.current=setInterval(()=>{let e=Math.floor((Date.now()-a)/1e3),t=Math.max(0,l-e),n=Math.min(1,e/l);if(s.announceAtPercentages)for(let a of s.announceAtPercentages){let l="percent-".concat(a);n>=a&&!o.current.has(l)&&(i(u("{childName}, you're ".concat(Math.round(100*a),"% done with {taskTitle}. ").concat(t>0?c(t)+" remaining.":"Time is up!"),t,e)),o.current.add(l))}if(s.announceAtSecondsRemaining)for(let n of s.announceAtSecondsRemaining){let a="remaining-".concat(n);t<=n&&t>n-1&&!o.current.has(a)&&(i(u("{childName}, {taskTitle} - ".concat(c(t)," remaining!"),t,e)),o.current.add(a))}0!==t||o.current.has("timeup")||(i(u("{childName}, time is up for {taskTitle}!")),o.current.add("timeup"))},1e3),()=>{r.current&&(clearInterval(r.current),r.current=null)}},[e,t,n,s,i]),(0,a.useEffect)(()=>{o.current.clear()},[null==e?void 0:e.id])};var v=e.i(7068);function x(e){var n,r,m,h,f,x,j,y,k,S,N,b;let{task:C,instance:T,childId:w}=e,{state:A,dispatch:D}=(0,l.useChoresApp)(),{openTaskEditModal:I}=(0,s.useModalControl)(),[E,_]=a.default.useState(!1),[O,M]=a.default.useState(!0),[P,R]=a.default.useState(null),[L,K]=a.default.useState(!1),[F,U]=a.default.useState(!1),[B,W]=a.default.useState(!1),H=T||C.instance,q=function(e,t){var n;let a=(0,v.getTodayString)(),l=e.taskKey||"".concat(t,"-").concat(e.id,"-").concat(a);return{...e,id:e.id,title:e.title,emoji:e.emoji||"",color:e.color||"#ccc",stars:e.stars||0,money:e.money||0,isCompleted:!!e.isCompleted,taskKey:l,type:e.type,timedAllowedSeconds:null==(n=e.timed)?void 0:n.allowedSeconds,pendingCompletionId:e.pendingCompletionId,pendingCompletion:e.pendingCompletion}}(C,w),z=(0,v.getTodayString)(),J=(null==H?void 0:H.date)||z,V=q.taskKey||"".concat(w,"-").concat(q.id,"-").concat(J),X=H?H.completed:q.isCompleted,{activeTimer:$,start:G,stop:Y}=p(V,w),Q=A.children.find(e=>e.id===w),Z=(null==Q?void 0:Q.name)||"Child",ee=a.default.useMemo(()=>{if($&&A.timers)return Object.values(A.timers).find(e=>e.id===$.id)},[$,A.timers]),et=A.parentSettings.voiceAnnouncements,en=!1!==q.voiceAnnouncements,ea=(null==et?void 0:et.enabled)&&(null==et||null==(n=et.timerAnnouncements)?void 0:n.enabled)&&en;g(ee,q.timed?q:void 0,Z,ea?{enabled:!0,volume:null!=(x=et.volume)?x:1,rate:null!=(j=et.rate)?j:1,pitch:null!=(y=et.pitch)?y:1,announceAtPercentages:null==(r=et.timerAnnouncements)?void 0:r.announceAtPercentages,announceAtSecondsRemaining:null==(m=et.timerAnnouncements)?void 0:m.announceAtSecondsRemaining,announceAtStart:null==(h=et.timerAnnouncements)?void 0:h.announceAtStart,messageFormat:null==(f=et.timerAnnouncements)?void 0:f.messageFormat}:{enabled:!1});let el=a.default.useMemo(()=>{if(q.pendingCompletionId&&q.pendingCompletion)return q.pendingCompletion;let e=(A.timedCompletions||[]).find(e=>e.taskKey===V&&e.childId===w&&!e.approved);return!e&&q.id&&(e=(A.timedCompletions||[]).find(e=>{let t=e.taskKey.split("-");if(t.length>=5){let n=t.slice(1,-3).join("-"),a=t.slice(-3).join("-");return n===q.id&&a===J&&e.childId===w&&!e.approved}return!1})),e},[A.timedCompletions,V,w,q.pendingCompletionId,q.pendingCompletion,q.id,J]),es=q.pendingCompletionId||(null==el?void 0:el.id),ei=()=>{if(H){var e,t,n,a;if(H.id.startsWith("projected_")||H.id.startsWith("scheduled_")){let n={...H,id:"realized_".concat(q.id,"_").concat(w,"_").concat(H.date,"_").concat(Date.now()),createdAt:new Date().toISOString()};D({type:"ADD_TASK_INSTANCE",payload:n}),D({type:"COMPLETE_TASK_INSTANCE",payload:{instanceId:n.id,childId:w,starReward:Number((null!=(e=n.stars)?e:q.stars)||0),moneyReward:Number((null!=(t=n.money)?t:q.money)||0)}})}else D({type:"COMPLETE_TASK_INSTANCE",payload:{instanceId:H.id,childId:w,starReward:Number((null!=(n=H.stars)?n:q.stars)||0),moneyReward:Number((null!=(a=H.money)?a:q.money)||0)}})}else D({type:"COMPLETE_TASK",payload:{taskKey:V,childId:w,starReward:Number(q.stars||0),moneyReward:Number(q.money||0)}})},{emoji:eo,title:er,color:ed}=q,ec=null!=(S=null!=(k=null==H?void 0:H.stars)?k:q.stars)?S:0,eu=null!=(b=null!=(N=null==H?void 0:H.money)?N:q.money)?b:0,ep=a.default.useMemo(()=>{let e=(null==H?void 0:H.dueAt)||(null==H?void 0:H.date);return e?(0,v.formatDateTimeCompact)(e):null},[H]),em=a.default.useMemo(()=>{if(X)return!1;let e=null==H?void 0:H.dueAt;if(!e||!e.includes("T"))return!1;let t=new Date(e);return!Number.isNaN(t.getTime())&&Date.now()>t.getTime()},[H,X]);return(0,t.jsxs)("div",{className:"task-item".concat(X?" completed":""),style:{borderColor:ed},draggable:!X,onDragStart:e=>{let t=(null==H?void 0:H.date)||(0,v.getTodayString)();e.dataTransfer.setData("text/plain",JSON.stringify({taskId:q.id,taskKey:q.taskKey,sourceChildId:w,taskType:q.type,instanceDate:t})),e.dataTransfer.effectAllowed="move",e.stopPropagation()},"data-task-id":q.id,"data-task-title":er,children:[!X&&(0,t.jsx)("span",{className:"drag-handle",children:"â‹®â‹®"}),(0,t.jsxs)("div",{className:"task-info",children:[(0,t.jsx)("span",{className:"task-emoji",children:eo}),$&&(0,t.jsx)("div",{style:{marginLeft:8},children:(0,t.jsx)(u,{startedAt:$.startedAt,allowedSeconds:$.allowedSeconds,size:36})}),(0,t.jsxs)("div",{className:"task-details",children:[(0,t.jsxs)("div",{className:"task-header-row",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[(0,t.jsx)("div",{className:"task-name",children:er}),(ep||em)&&(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,color:em?"#e53e3e":"#4a5568",fontSize:"0.9rem"},children:[em&&(0,t.jsx)("span",{title:"Overdue",children:"âš ï¸Ž"}),ep&&(0,t.jsx)("span",{className:"task-due-inline",children:ep})]})]}),(0,t.jsxs)("div",{className:"task-reward",style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[(0,t.jsxs)("span",{children:["â­ ",Number(ec)]}),(0,t.jsxs)("span",{children:["ðŸ’° $",Number(eu).toFixed(2)]})]})]})]}),(0,t.jsxs)("div",{className:"task-actions",children:[q.timed||"number"==typeof q.timedAllowedSeconds?es?(0,t.jsxs)("div",{className:"pending-actions",children:[(0,t.jsx)("span",{className:"pending-label",children:"Pending approval"}),(0,t.jsx)("button",{className:"approve-btn",onClick:()=>{es&&(R(es),M(!0),_(!0))},children:"Approve"}),(0,t.jsx)("button",{className:"forgive-btn",onClick:()=>{es&&(R(es),M(!1),_(!0))},children:"Forgive"})]}):$?(0,t.jsx)("button",{className:"complete-btn",onClick:()=>Y(),children:"Stop"}):(0,t.jsx)("button",{className:"complete-btn",onClick:()=>G(),disabled:X,children:"Start"}):(0,t.jsx)("button",{className:"complete-btn",onClick:()=>{if(q.timed||"number"==typeof q.timedAllowedSeconds)return;let e=(0,v.getTodayString)(),t=((null==H?void 0:H.date)||e)>e?A.parentSettings.approvals.earlyComplete:A.parentSettings.approvals.taskComplete,n=A.parentSettings.pins||[];if(t)return 0===n.length?void W(!0):(R((null==H?void 0:H.id)||V||""),void _(!0));ei()},disabled:X,children:X?"âœ“ Done":"Complete"}),(0,t.jsxs)("button",{className:"btn-icon-text btn-edit",onClick:()=>{U(!0)},title:"Edit task: ".concat(er),"aria-label":"Edit task: ".concat(er),"data-task-id":q.id,"data-task-title":er,children:[(0,t.jsx)("span",{className:"btn-icon",children:"âœï¸"}),(0,t.jsx)("span",{className:"btn-text",children:"Edit"})]}),(0,t.jsxs)("button",{className:"btn-icon-text btn-danger",onClick:()=>{K(!0)},title:"Delete task",children:[(0,t.jsx)("span",{className:"btn-icon",children:"ðŸ—‘ï¸"}),(0,t.jsx)("span",{className:"btn-text",children:"Delete"})]}),(0,t.jsx)(i.default,{open:E,onClose:()=>{_(!1),R(null)},onSuccess:e=>{_(!1),P&&es?(D({type:"APPROVE_TIMED_COMPLETION",payload:{completionId:P,approve:!0,applyMoney:O,actorHandle:e}}),R(null)):ei()},message:P&&es?O?"Approve this timed completion?":"Forgive money for this timed completion?":"Enter a parent PIN to complete this task."}),(0,t.jsx)(o.default,{open:B,onClose:()=>W(!1),title:"Approval Required",message:(()=>{let e=(0,v.getTodayString)();return((null==H?void 0:H.date)||e)>e?"Early task completion requires parent approval, but no approvers are defined. Please add an approver in Settings first.":"Task completion requires parent approval, but no approvers are defined. Please add an approver in Settings first."})()}),(0,t.jsx)(c,{open:F,onClose:()=>U(!1),onConfirm:e=>{U(!1),I(q.id,e,null==H?void 0:H.id)},task:q,taskTitle:q.title}),(0,t.jsx)(d,{open:L,onClose:()=>K(!1),onConfirm:e=>{let t=String(q.id),n=null==H?void 0:H.id,a=new Date().toISOString().split("T")[0];switch(e){case"instance":n&&D({type:"DELETE_TASK_INSTANCE",payload:n});break;case"future":D({type:"DISABLE_TASK_AFTER_DATE",payload:{taskId:t,date:a}}),n&&D({type:"DELETE_TASK_INSTANCE",payload:n});break;case"template":D({type:"DELETE_TASK",payload:t}),n&&D({type:"DELETE_TASK_INSTANCE",payload:n})}K(!1)},task:q,taskTitle:q.title})]})]})}var j=e.i(55612),y=e.i(55474),k=e.i(51575),S=e.i(8430),N=e.i(18994),b=e.i(41943);let C=["function transfer(address to, uint256 amount) returns (bool)","function decimals() view returns (uint8)","function symbol() view returns (string)"];function T(e){let{open:n,onClose:l,child:s,defaultAmount:i=0}=e,{address:o}=(0,k.useAccount)(),{connectAsync:r}=(0,k.useConnect)(),{chain:d}=(0,k.useNetwork)(),{switchNetwork:c}=(0,k.useSwitchNetwork)(),{data:u}=(0,k.useWalletClient)(),[p,m]=a.default.useState(null),[h,f]=a.default.useState(i?String(i):"0.01"),[g,v]=a.default.useState("ETH"),[x,j]=a.default.useState(null),[y,T]=a.default.useState(1);a.default.useEffect(()=>{n||(j(null),f(i?String(i):"0.01"))},[n,i]);let w=async()=>{try{var e;if(!window.ethereum)return void j("No web3 wallet found");let t=await r({connector:new S.InjectedConnector}),n=(null==t?void 0:t.account)||o;n&&m(String(n)),T((null==t||null==(e=t.chain)?void 0:e.id)||(null==d?void 0:d.id)||1),j("Connected: "+(n||""))}catch(e){j("Connect error: "+String((null==e?void 0:e.message)||String(e)))}},A=async e=>{if(!window.ethereum)return j("No wallet");try{if(c)c(e),j("Switched network"),T(e);else{let t=window.ethereum;t.request&&await t.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x"+e.toString(16)}]}),j("Switched network"),T(e)}}catch(e){j("Switch error: "+String((null==e?void 0:e.message)||String(e)))}},D=async()=>{if(!u)return j("Please connect your wallet first");if(!s.blockchainAddress)return j("Child has no blockchain address set in Settings");try{if(j("Preparing transaction..."),"ETH"===g){let e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"wei";return(0,b.parseUnits)(e,N.etherUnits[t])}(h||"0");if(!(null==u?void 0:u.sendTransaction))return j("Wallet client can't send transactions");let t=await u.sendTransaction({to:s.blockchainAddress,value:e});j("Sent. Transaction hash: "+String(t))}else{let e={1:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",42161:"0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8",8453:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913"}[y];if(!e)return j("USDC not configured for this network");let t=(0,b.parseUnits)(h||"0",6);if(!(null==u?void 0:u.writeContract))return j("Wallet client can't write contracts");let n=await u.writeContract({address:e,abi:C,functionName:"transfer",args:[s.blockchainAddress,t]});j("USDC transfer submitted: "+String(n))}}catch(e){j("Send error: "+String((null==e?void 0:e.message)||String(e)))}};return n?(0,t.jsx)("div",{className:"modal-overlay",onClick:l,children:(0,t.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsxs)("h2",{children:["Pay ",s.name," On-Chain"]}),(0,t.jsx)("span",{className:"close",onClick:e=>{e.stopPropagation(),l()},children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("label",{children:"Child address / ENS:"}),(0,t.jsx)("div",{children:s.blockchainAddress||(0,t.jsx)("em",{children:"Not set"})})]}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("label",{children:"Token:"}),(0,t.jsxs)("select",{value:g,onChange:e=>v(e.target.value),children:[(0,t.jsx)("option",{value:"ETH",children:"ETH"}),(0,t.jsx)("option",{value:"USDC",children:"USDC"})]})]}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsxs)("label",{children:["Amount (","ETH"===g?"ETH":"USDC","):"]}),(0,t.jsx)("input",{value:h,onChange:e=>f(e.target.value),placeholder:"0.01"})]}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("label",{children:"Network:"}),(0,t.jsxs)("select",{value:y,onChange:e=>A(Number(e.target.value)),children:[(0,t.jsx)("option",{value:1,children:"Ethereum Mainnet"}),(0,t.jsx)("option",{value:42161,children:"Arbitrum One"}),(0,t.jsx)("option",{value:8453,children:"Base"})]})]}),(0,t.jsx)("div",{className:"input-group",children:p?(0,t.jsxs)("div",{style:{padding:"8px",background:"#f7fafc",borderRadius:"4px"},children:["Connected: ",p]}):(0,t.jsx)("button",{className:"btn btn-primary",onClick:w,children:"Connect Wallet"})}),x&&(0,t.jsx)("div",{className:"error-message",style:{marginTop:"12px",background:x.includes("error")||x.includes("error")?"#fed7d7":"#d1fae5",color:x.includes("error")||x.includes("error")?"#c53030":"#065f46"},children:x})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:D,children:"Send Payment"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:l,children:"Cancel"})]})]})}):null}function w(e){let{open:n,onClose:s,childId:i}=e,{state:o}=(0,l.useChoresApp)(),[d,c]=(0,a.useState)(!1);if((0,a.useEffect)(()=>(c(!0),()=>c(!1)),[]),!n||!d)return null;let u=(o.actionLog||[]).filter(e=>{if(!i)return!0;let t=e.payload;return!!t&&"object"==typeof t&&(t.childId===i||t.child&&"object"==typeof t.child&&null!==t.child&&t.child.id===i||t.task&&"object"==typeof t.task&&null!==t.task&&t.task.childId===i)}).slice().reverse(),p=u.slice(0,50),m=u.slice(0,100),h=(0,t.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,t.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsxs)("h2",{children:["Action Log ",i?"for child ".concat(i):""]}),(0,t.jsx)("span",{className:"close",onClick:e=>{e.stopPropagation(),s()},children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",style:{maxHeight:"50vh",overflow:"auto"},children:[0===p.length&&(0,t.jsx)("div",{style:{textAlign:"center",color:"#666",padding:"20px"},children:"No recent actions"}),p.map(e=>(0,t.jsxs)("div",{style:{borderBottom:"1px solid #e2e8f0",padding:"12px",marginBottom:"8px"},children:[(0,t.jsx)("div",{style:{fontSize:"0.75rem",color:"#666",marginBottom:"4px"},children:new Date(e.timestamp).toLocaleString()}),(0,t.jsx)("div",{style:{fontWeight:600,marginBottom:"4px",color:"#1a202c"},children:e.actionType}),e.actorHandle&&(0,t.jsxs)("div",{style:{fontSize:"0.75rem",color:"#4a5568",marginBottom:"4px",fontStyle:"italic"},children:["Approved by: ",e.actorHandle]}),(0,t.jsx)("pre",{style:{whiteSpace:"pre-wrap",fontSize:"0.7rem",background:"#f7fafc",padding:"8px",borderRadius:"4px",overflow:"auto",maxHeight:"200px"},children:JSON.stringify(e.payload||{},null,2)})]},e.id))]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{let e=new Blob([JSON.stringify({entries:m,exportedAt:new Date().toISOString(),totalEntries:m.length,filteredByChildId:i||null},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="action-log-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},children:"Export JSON (last 100)"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:()=>{let e=new Blob([["id,actionType,actorHandle,timestamp,payload",...m.map(e=>[e.id,e.actionType,e.actorHandle||"",e.timestamp,JSON.stringify(e.payload||{})]).map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(","))].join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="action-log-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},children:"Export CSV (last 100)"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:s,children:"Close"})]})]})});return(0,r.createPortal)(h,document.body)}function A(e){let{open:n,onClose:l,onConfirm:s,task:i,taskTitle:o,targetChildName:d}=e,[c,u]=(0,a.useState)(!1),[p,m]=(0,a.useState)("instance");if((0,a.useEffect)(()=>(u(!0),()=>u(!1)),[]),(0,a.useEffect)(()=>{n&&i&&m("instance")},[n,i]),!n||!c||!i)return null;let h=o||i.title||"Task",f=(0,t.jsx)("div",{className:"modal-overlay",onClick:l,children:(0,t.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h2",{children:"Move Task"}),(0,t.jsx)("span",{className:"close",onClick:e=>{e.stopPropagation(),l()},children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("p",{children:["This task rotates across children. How would you like to move ",(0,t.jsx)("strong",{children:h})," to ",d||"this child","?"]}),(0,t.jsxs)("div",{className:"delete-options",children:[(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"dragDropOption",value:"instance",checked:"instance"===p,onChange:()=>m("instance")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Move just this occurrence"}),(0,t.jsx)("p",{className:"option-description",children:"Move only this instance. Future rotations will continue as scheduled."})]})]}),(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"dragDropOption",value:"redo-rotations",checked:"redo-rotations"===p,onChange:()=>m("redo-rotations")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Redo all future rotations"}),(0,t.jsx)("p",{className:"option-description",children:"Update the rotation to start from today with this child, and regenerate all future assignments."})]})]})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{s(p),l()},children:"Move"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:l,children:"Cancel"})]})]})});return(0,r.createPortal)(f,document.body)}let D={enabled:!1,volume:1,rate:1,pitch:1,announceMinutesBefore:[15,5],announceAtDueTime:!0,messageFormat:"{childName}, {taskTitle} is coming up in {timeUntil}!"},I=function(e,t){let n={...D,...t},{speak:l}=h(n),s=(0,a.useRef)(new Set),i=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!n.enabled||0===e.length){s.current.clear(),i.current&&(clearInterval(i.current),i.current=null);return}let t=e=>e<1?"less than a minute":1===e?"1 minute":"".concat(Math.floor(e)," minutes");return i.current=setInterval(()=>{let a=Date.now();e.forEach(e=>{var i,o;let{task:r,instance:d,child:c}=e;if(!d.dueAt)return;let u=(new Date(d.dueAt).getTime()-a)/6e4,p="".concat(d.id,"-").concat(c.id);if(!d.completed){if(n.announceAtDueTime){let e="".concat(p,"-due");u<=.5&&u>=-.5&&!s.current.has(e)&&(l((null==(i=n.messageFormat)?void 0:i.replace(/{taskTitle}/g,r.title||"your task").replace(/{childName}/g,c.name).replace(/{timeUntil}/g,"now"))||"".concat(c.name,", it's time for ").concat(r.title||"your task","!")),s.current.add(e))}if(n.announceMinutesBefore)for(let e of n.announceMinutesBefore){let a="".concat(p,"-").concat(e,"min");u<=e+.5&&u>=e-.5&&u>0&&!s.current.has(a)&&(l((null==(o=n.messageFormat)?void 0:o.replace(/{taskTitle}/g,r.title||"your task").replace(/{childName}/g,c.name).replace(/{timeUntil}/g,t(e)))||"".concat(c.name,", ").concat(r.title||"your task"," is coming up in ").concat(t(e),"!")),s.current.add(a))}}})},3e4),()=>{i.current&&(clearInterval(i.current),i.current=null)}},[e,n,l]),(0,a.useEffect)(()=>{s.current.clear()},[e.map(e=>{let{instance:t}=e;return t.id}).join(",")])};function E(e){var n,r,c,u,p,m,h,f,g,k,S;let{child:N,onAddTask:b}=e,{state:C,dispatch:D}=(0,l.useChoresApp)(),{openEditChildModal:E}=(0,s.useModalControl)(),[_,O]=a.default.useState(!1),[M,P]=a.default.useState(!1),[R,L]=a.default.useState(!1),[K,F]=a.default.useState(!1),[U,B]=a.default.useState(!1),[W,H]=a.default.useState(!1),[q,z]=a.default.useState(!1),[J,V]=a.default.useState(null),[X,$]=a.default.useState(!1),[G,Y]=a.default.useState(null),[Q,Z]=a.default.useState(!1),[ee,et]=a.default.useState(null),[en,ea]=a.default.useState(!1),[el,es]=a.default.useState(null),[ei,eo]=a.default.useState(!1),er=(e,t)=>{let n=t.split("T")[0],a=(C.taskInstances||[]).find(t=>t.templateId===e.id&&t.date===n);a?D({type:"UPDATE_TASK_INSTANCE",payload:{...a,childId:N.id}}):D({type:"ADD_TASK_INSTANCE",payload:{id:"realized_".concat(e.id,"_").concat(N.id,"_").concat(n,"_").concat(Date.now()),templateId:e.id,childId:N.id,date:n,completed:!1,createdAt:new Date().toISOString(),stars:e.stars,money:e.money}})},ed=(0,v.getTodayString)(),[ec,eu]=(0,a.useState)(!1);(0,a.useEffect)(()=>{eu(!0)},[]);let ep=(C.taskInstances||[]).filter(e=>e.childId===N.id&&e.date===ed),em=(0,a.useMemo)(()=>{if(!ec)return[];let e=[];return C.tasks.forEach(t=>{if(!t.enabled||(C.taskInstances||[]).find(e=>e.templateId===t.id&&e.date===ed))return;let n=(0,j.getTheoreticalAssignment)(t,ed,C.tasks).find(e=>e.childId===N.id);if(n){let a=function(e,t){var n,a,l,s,i,o,r;if("oneoff"===e.type&&(null==(n=e.oneOff)?void 0:n.dueDate))return e.oneOff.dueDate.split("T")[0]===t?e.oneOff.dueDate:void 0;let d=(null==(a=e.schedule)?void 0:a.dueTime)||(null==(s=e.schedule)||null==(l=s.rule)?void 0:l.startTime)||(null==(o=e.schedule)||null==(i=o.rule)?void 0:i.timeOfDay)||(null==(r=e.recurring)?void 0:r.timeOfDay);if(!d)return;let[c,u]=d.split(":").map(e=>parseInt(e,10));if(isNaN(c)||isNaN(u))return;let p=(0,v.parseLocalDate)(t);return p.setHours(c,u,0,0),p.toISOString()}(t,ed),l={id:"projected_".concat(t.id,"_").concat(N.id,"_").concat(ed),templateId:t.id,childId:N.id,date:ed,dueAt:a,completed:!1,createdAt:new Date().toISOString(),stars:t.stars,money:t.money,rotationIndex:n.rotationIndex};e.push({...t,instance:l,taskKey:"".concat(N.id,"-").concat(t.id,"-").concat(ed),isCompleted:!1})}}),e},[C.tasks,C.taskInstances,ed,N.id,ec]),eh=(0,a.useMemo)(()=>{let e=[];return ep.forEach(t=>{let n=C.tasks.find(e=>e.id===t.templateId);if(!n)return;let a="".concat(t.childId,"-").concat(t.templateId,"-").concat(t.date),l=t.completed,s=(C.timedCompletions||[]).find(e=>e.taskKey===a&&e.childId===t.childId&&!e.approved);e.push({...n,instance:t,taskKey:a,isCompleted:l,pendingCompletionId:null==s?void 0:s.id,pendingCompletion:s})}),e},[ep,C.tasks,C.timedCompletions]),ef=(0,a.useMemo)(()=>[...eh,...em],[eh,em]),eg=[],ev=[];ef.forEach(e=>{if("oneoff"===e.type||e.oneOff){var t;let n=null==(t=e.oneOff)?void 0:t.dueDate;n&&n.split("T")[0]===ed?eg.push(e):ev.push(e)}else eg.push(e)});let ex=eg.filter(e=>e.isCompleted),ej=eg.filter(e=>!e.isCompleted),[ey,ek]=(0,a.useState)(!1),[eS,eN]=(0,a.useState)(!1),eb=(0,a.useMemo)(()=>{if(!ec)return[];let e=[],t=new Date(ed);t.setDate(t.getDate()+7);let n=new Date(ed);for(n.setDate(n.getDate()+1);n<=t;){let t=(0,v.getLocalDateString)(n);if(t===ed){n.setDate(n.getDate()+1);continue}C.tasks.forEach(n=>{var a,l;if(!n.enabled)return;let s=(C.taskInstances||[]).find(e=>e.templateId===n.id&&e.date===t);if(s){s.childId===N.id&&e.push({task:n,dateTime:"".concat(t,"T").concat((null==(a=n.schedule)?void 0:a.dueTime)||"00:00"),date:t});return}(0,j.getTheoreticalAssignment)(n,t,C.tasks).find(e=>e.childId===N.id)&&e.push({task:n,dateTime:"".concat(t,"T").concat((null==(l=n.schedule)?void 0:l.dueTime)||"00:00"),date:t})}),n.setDate(n.getDate()+1)}let a=e.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());return ey?a:a.slice(0,5)},[C.tasks,C.taskInstances,N.id,ed,ec,ey]),eC=(0,a.useMemo)(()=>{if(!ec)return 0;let e=0,t=new Date(ed);t.setDate(t.getDate()+7);let n=new Date(ed);for(n.setDate(n.getDate()+1);n<=t;){let t=(0,v.getLocalDateString)(n);if(t===ed){n.setDate(n.getDate()+1);continue}C.tasks.forEach(n=>{if(!n.enabled)return;let a=(C.taskInstances||[]).find(e=>e.templateId===n.id&&e.date===t);a?a.childId===N.id&&e++:(0,j.getTheoreticalAssignment)(n,t,C.tasks).some(e=>e.childId===N.id)&&e++}),n.setDate(n.getDate()+1)}return e},[C.tasks,C.taskInstances,N.id,ed,ec]),eT=eC>5,ew=(0,a.useMemo)(()=>{if(!ec)return[];let e=[];return ef.forEach(t=>{var n;(t.instance.dueAt||(null==(n=t.schedule)?void 0:n.dueTime))&&e.push({task:t,instance:t.instance,child:N})}),eb.forEach(t=>{let{task:n,dateTime:a,date:l}=t,s={id:"scheduled_".concat(n.id,"_").concat(N.id,"_").concat(l),templateId:n.id,childId:N.id,date:l,dueAt:a,stars:n.stars,money:n.money,completed:!1,createdAt:new Date().toISOString()};e.push({task:n,instance:s,child:N})}),e},[ef,eb,N,ec]),eA=C.parentSettings.voiceAnnouncements;return I((0,a.useMemo)(()=>ew.filter(e=>{let{task:t}=e;return!1!==t.voiceAnnouncements}),[ew]),(null==eA||null==(n=eA.scheduledAnnouncements)?void 0:n.enabled)?{enabled:eA.enabled&&null!=(m=null==(r=eA.scheduledAnnouncements)?void 0:r.enabled)&&m,volume:null!=(h=eA.volume)?h:1,rate:null!=(f=eA.rate)?f:1,pitch:null!=(g=eA.pitch)?g:1,announceMinutesBefore:null==(c=eA.scheduledAnnouncements)?void 0:c.announceMinutesBefore,announceAtDueTime:null==(u=eA.scheduledAnnouncements)?void 0:u.announceAtDueTime,messageFormat:null==(p=eA.scheduledAnnouncements)?void 0:p.messageFormat}:{enabled:!1}),(0,t.jsxs)("div",{className:"child-column".concat(R?" drag-over":""),"data-child-id":N.id,onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",L(!0)},onDragLeave:()=>{L(!1)},onDrop:e=>{e.preventDefault(),L(!1);let t=e.dataTransfer.getData("text/plain");if(!t.startsWith("child-"))try{var n;let{taskId:e,sourceChildId:a,instanceDate:l}=JSON.parse(t);if(a===N.id)return;let s=C.tasks.find(t=>t.id===e);if(!s)return;let i=C.parentSettings.approvals.taskMove,o=C.parentSettings.pins||[];if(i){if(0===o.length)return void eo(!0);Y({task:s,instanceDate:l||(0,v.getTodayString)()}),H(!0);return}(null==(n=s.rotation)?void 0:n.mode)==="round-robin"?(Y({task:s,instanceDate:l||(0,v.getTodayString)()}),$(!0)):er(s,l||(0,v.getTodayString)())}catch(e){console.error("Drop error:",e)}},children:[R&&(0,t.jsx)("div",{className:"drop-indicator",children:"Drop task here"}),(0,t.jsxs)("div",{className:"child-header",children:[(0,t.jsxs)("div",{className:"child-name-row",children:[(0,t.jsx)("span",{className:"child-name",children:N.name}),(0,t.jsxs)("div",{className:"child-header-actions",children:[(0,t.jsxs)("button",{className:"btn-icon-text",onClick:()=>E(N.id),title:"Edit child",children:[(0,t.jsx)("span",{className:"btn-icon",children:"âœï¸"}),(0,t.jsx)("span",{className:"btn-text",children:"Edit"})]}),(0,t.jsxs)("button",{className:"btn-icon-text",onClick:()=>{if(0>=(N.money||0))return void F(!0);B(!0)},title:"Pay out cash",children:[(0,t.jsx)("span",{className:"btn-icon",children:"ðŸ’µ"}),(0,t.jsx)("span",{className:"btn-text",children:"Pay"})]}),(0,t.jsxs)("button",{className:"btn-icon-text",onClick:()=>{O(!0)},title:"Pay on blockchain",children:[(0,t.jsx)("span",{className:"btn-icon",children:"ðŸŒ"}),(0,t.jsx)("span",{className:"btn-text",children:"Wallet"})]}),(0,t.jsxs)("button",{className:"btn-icon-text",onClick:()=>P(!0),title:"View action log",children:[(0,t.jsx)("span",{className:"btn-icon",children:"ðŸ“"}),(0,t.jsx)("span",{className:"btn-text",children:"Log"})]})]})]}),(0,t.jsxs)("div",{className:"child-stats",children:[(0,t.jsxs)("div",{className:"stat-item",children:[(0,t.jsx)("span",{children:"â­"}),(0,t.jsx)("span",{children:null!=(k=N.stars)?k:0})]}),(0,t.jsxs)("div",{className:"stat-item",children:[(0,t.jsx)("span",{children:"ðŸ’°"}),(0,t.jsxs)("span",{children:["$",(null!=(S=N.money)?S:0).toFixed(2)]})]})]})]}),(0,t.jsxs)("div",{className:"tasks-list",children:[(0,t.jsxs)("div",{className:"tasks-section",children:[(0,t.jsxs)("div",{className:"section-title",children:["Today's Tasks",(0,t.jsx)("button",{className:"add-task-btn",onClick:b,children:"+ Task"})]}),0===ej.length&&0===ex.length?(0,t.jsx)("div",{className:"empty-state",children:"No tasks for today"}):(0,t.jsxs)(t.Fragment,{children:[ej.map(e=>{let n="".concat(e.instance.id.startsWith("projected")?"p":"r","-").concat(e.instance.id);return(0,t.jsx)(x,{task:e,instance:e.instance,childId:N.id},n)}),ex.length>0&&(0,t.jsxs)("div",{className:"completed-tasks",children:[(0,t.jsx)("button",{className:"see-more-btn",onClick:()=>eN(!eS),children:eS?"Hide completed":"Show completed (".concat(ex.length,")")}),eS&&ex.map(e=>{let n="completed-".concat(e.instance.id);return(0,t.jsx)(x,{task:e,instance:e.instance,childId:N.id},n)})]})]})]}),ev.length>0&&(0,t.jsxs)("div",{className:"tasks-section inactive-tasks",children:[(0,t.jsx)("div",{className:"section-title",children:"Upcoming Tasks"}),(0,t.jsx)(t.Fragment,{children:ev.map(e=>{let n="inactive-".concat(e.instance.id);return(0,t.jsx)(x,{task:e,instance:e.instance,childId:N.id},n)})})]}),eb.length>0&&(0,t.jsxs)("div",{className:"tasks-section upcoming-scheduled",children:[(0,t.jsx)("div",{className:"section-title",children:"Scheduled"}),(0,t.jsx)(t.Fragment,{children:eb.map(e=>{let{task:n,dateTime:a,date:l}=e,s=(C.taskInstances||[]).find(e=>e.templateId===n.id&&e.childId===N.id&&e.date===l)||{id:"scheduled_".concat(n.id,"_").concat(N.id,"_").concat(l),templateId:n.id,childId:N.id,date:l,dueAt:a,stars:n.stars,money:n.money,completed:!1,createdAt:new Date().toISOString()},i={...n,instance:s,taskKey:"".concat(s.childId,"-").concat(s.templateId,"-").concat(s.date),isCompleted:s.completed||!1},o=s.id||"".concat(n.id,"-").concat(a);return(0,t.jsx)(x,{task:i,instance:s,childId:N.id},o)})}),eT&&!ey&&(0,t.jsxs)("button",{className:"see-more-btn",onClick:()=>ek(!0),children:["See more (",eC," total)"]}),ey&&eT&&(0,t.jsx)("button",{className:"see-more-btn",onClick:()=>ek(!1),children:"Show less"})]})]}),_&&(0,t.jsx)(T,{open:_,onClose:()=>O(!1),child:N,defaultAmount:N.money||0}),M&&(0,t.jsx)(w,{open:M,onClose:()=>P(!1),childId:N.id}),(0,t.jsx)(o.default,{open:K,onClose:()=>F(!1),title:"Cannot Pay Out",message:"".concat(N.name," has no money to pay out.")}),(0,t.jsx)(o.default,{open:q,onClose:()=>z(!1),title:"Approval Required",message:"Early completion requires parent approval, but no approvers are defined. Please add an approver in Settings first."}),(0,t.jsx)(i.default,{open:W,onClose:()=>{H(!1),V(null),Y(null),et(null),es(null)},onSuccess:()=>{if(H(!1),J)((e,t)=>{var n,a,l,s,i,o;let r=t.split("T")[0],d=(C.taskInstances||[]).find(t=>t.templateId===e.id&&t.childId===N.id&&t.date===r);if(d)d.completed||D({type:"COMPLETE_TASK_INSTANCE",payload:{instanceId:d.id,childId:N.id,starReward:Number(null!=(a=null!=(n=d.stars)?n:e.stars)?a:0),moneyReward:Number(null!=(s=null!=(l=d.money)?l:e.money)?s:0)}});else{let t={id:"realized_".concat(e.id,"_").concat(N.id,"_").concat(r,"_").concat(Date.now()),templateId:e.id,childId:N.id,date:r,completed:!1,createdAt:new Date().toISOString(),stars:e.stars,money:e.money};D({type:"ADD_TASK_INSTANCE",payload:t}),D({type:"COMPLETE_TASK_INSTANCE",payload:{instanceId:t.id,childId:N.id,starReward:Number(null!=(i=e.stars)?i:0),moneyReward:Number(null!=(o=e.money)?o:0)}})}})(J.task,J.date),V(null);else if(G){var e;let{task:t,instanceDate:n}=G;(null==(e=t.rotation)?void 0:e.mode)==="round-robin"?$(!0):(er(t,n),Y(null))}else if(ee&&el){let{task:e,date:t}=ee,n=t.split("T")[0];"template"===el?D({type:"DELETE_TASK",payload:e.id}):D({type:"DISABLE_TASK_AFTER_DATE",payload:{taskId:e.id,date:n}}),et(null),es(null)}},message:J?"Enter a parent PIN to approve completing this task early.":G?"Enter a parent PIN to approve moving this task.":ee?"Enter a parent PIN to approve deleting or disabling this task.":"Enter a parent PIN."}),(0,t.jsx)(o.default,{open:ei,onClose:()=>eo(!1),title:"Approval Required",message:"Moving tasks requires parent approval, but no approvers are defined. Please add an approver in Settings first."}),(0,t.jsx)(o.default,{open:en,onClose:()=>ea(!1),title:"Approval Required",message:"Editing/deleting tasks requires parent approval, but no approvers are defined. Please add an approver in Settings first."}),(0,t.jsx)(d,{open:Q,onClose:()=>{Z(!1),et(null),es(null)},onConfirm:e=>{var t,n,a;if(Z(!1),!ee)return;let l=!!(null==(n=C.parentSettings)||null==(t=n.approvals)?void 0:t.editTasks),s=(null==(a=C.parentSettings)?void 0:a.pins)||[];if(l)return 0===s.length?void ea(!0):(es(e),void H(!0));let{task:i,date:o}=ee,r=o.split("T")[0];"template"===e?D({type:"DELETE_TASK",payload:i.id}):D({type:"DISABLE_TASK_AFTER_DATE",payload:{taskId:i.id,date:r}}),et(null),es(null)},task:ee?ee.task:null,taskTitle:ee?ee.task.title||"Task":void 0}),(0,t.jsx)(y.default,{open:U,onClose:()=>B(!1),onConfirm:()=>{D({type:"PAY_CHILD",payload:N.id})},title:"Pay Out",message:"Pay ".concat(N.name," $").concat((N.money||0).toFixed(2),"?"),confirmText:"Pay",cancelText:"Cancel"}),(0,t.jsx)(A,{open:X,onClose:()=>{$(!1),Y(null)},onConfirm:e=>{if(!G)return;let{task:t,instanceDate:n}=G;"instance"===e?er(t,n):"redo-rotations"===e&&(e=>{var t,n;let a=new Date,l=(null==(t=e.rotation)?void 0:t.assignedChildIds)||e.assignedChildIds||[],s=l.indexOf(N.id),i=s>=0?s:0,o=new Date(a);o.setDate(o.getDate()-i);let r=(0,v.getLocalDateString)(o);D({type:"UPDATE_TASK",payload:{...e,id:e.id,rotation:{...e.rotation,mode:(null==(n=e.rotation)?void 0:n.mode)||"round-robin",assignedChildIds:l.length>0?l:[N.id],startDate:r,lastAssignedChildId:N.id,lastRotationIndex:i}}})})(t),Y(null)},task:(null==G?void 0:G.task)||null,targetChildName:N.name})]})}function _(e){let{childrenList:n,onAddTask:s}=e,{state:i,dispatch:o}=(0,l.useChoresApp)(),r=a.default.useRef(null),[d,c]=a.default.useState(null),u=()=>{let e=r.current;if(!e)return;let t=e.scrollWidth>e.clientWidth,n=e.scrollLeft<=5,a=e.scrollLeft>=e.scrollWidth-e.clientWidth-5;e.classList.toggle("scrollable-left",t&&!n),e.classList.toggle("scrollable-right",t&&!a)};a.default.useEffect(()=>{let e=r.current;if(e)return u(),e.addEventListener("scroll",u),window.addEventListener("resize",u),()=>{e.removeEventListener("scroll",u),window.removeEventListener("resize",u)}},[n]);let p=e=>{null!==d&&(e.preventDefault(),e.dataTransfer.dropEffect="move")},m=()=>{c(null)};return(0,t.jsx)("div",{ref:r,className:"children-grid","data-child-count":n.length,onDragOver:p,children:0===n.length?(0,t.jsxs)("div",{className:"no-children-message",children:[(0,t.jsx)("h3",{children:"No children configured"}),(0,t.jsx)("p",{children:'Add children using the "+ Add Child" button to start managing chores.'})]}):n.map(e=>(0,t.jsx)("div",{draggable:!0,onDragStart:t=>((e,t)=>{let n=e.target;n.closest(".task-item")||n.closest("[data-task-id]")||(c(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain","child-".concat(t)))})(t,e.id),onDragOver:p,onDrop:t=>((e,t)=>{if(e.preventDefault(),!e.dataTransfer.getData("text/plain").startsWith("child-")||null===d||d===t)return void c(null);let n=i.parentSettings.childDisplayOrder||[],a=i.children.map(e=>e.id),l=[...n.filter(e=>a.includes(e)),...a.filter(e=>!n.includes(e))],s=l.indexOf(d),r=l.indexOf(t);if(-1===s||-1===r)return void c(null);let u=[...l];u.splice(s,1),u.splice(r,0,d),o({type:"UPDATE_PARENT_SETTINGS",payload:{childDisplayOrder:u}}),c(null)})(t,e.id),onDragEnd:m,style:{opacity:d===e.id?.5:1,cursor:"move"},children:(0,t.jsx)(E,{child:e,onAddTask:s?()=>s(e.id):void 0})},e.id))})}function O(){let{state:e}=(0,l.useChoresApp)(),{openOneOffTaskModal:i}=(0,s.useModalControl)(),[o,r]=(0,a.useState)(!1);(0,a.useEffect)(()=>{r(!0)},[]);let d=a.default.useMemo(()=>{let t=e.parentSettings.childDisplayOrder||[];if(0===t.length)return[...e.children].sort((e,t)=>e.id-t.id);let n=new Map(e.children.map(e=>[e.id,e])),a=[],l=[];return t.forEach(e=>{let t=n.get(e);t&&(a.push(t),n.delete(e))}),n.forEach(e=>l.push(e)),l.sort((e,t)=>e.id-t.id),[...a,...l]},[e.children,e.parentSettings.childDisplayOrder]);return o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.default,{children:(0,t.jsx)("title",{children:"Family Chores"})}),(0,t.jsx)("main",{className:"main-view",children:(0,t.jsx)(_,{childrenList:d,onAddTask:i})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.default,{children:(0,t.jsx)("title",{children:"Family Chores"})}),(0,t.jsx)("main",{className:"main-view",children:(0,t.jsx)("div",{className:"children-grid",children:(0,t.jsx)("div",{className:"empty-state",children:"Loading..."})})})]})}},19675,(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",()=>e.r(43181)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push(["/"])})}]);
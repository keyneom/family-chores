(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,58678,(e,t,n)=>{t.exports=e.r(80963)},43181,e=>{"use strict";e.s(["default",()=>A],43181);var t=e.i(91398),n=e.i(58678),l=e.i(91788),a=e.i(66402),s=e.i(85134),i=e.i(55824),d=e.i(43028),o=e.i(30943);function r(e){let{open:n,onClose:a,onConfirm:s,task:i,taskTitle:d}=e,[r,c]=(0,l.useState)(!1),[u,p]=(0,l.useState)("instance");if((0,l.useEffect)(()=>(c(!0),()=>c(!1)),[]),(0,l.useEffect)(()=>{n&&i&&("oneoff"===i.type?p("template"):p("instance"))},[n,i]),!n||!r||!i)return null;let h="oneoff"===i.type||i.oneOff,m=d||i.title||"Task",f=(0,t.jsx)("div",{className:"modal-overlay",onClick:a,children:(0,t.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h2",{children:"Delete Task"}),(0,t.jsx)("span",{className:"close",onClick:e=>{e.stopPropagation(),a()},children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("p",{children:["What would you like to delete for ",(0,t.jsx)("strong",{children:m}),"?"]}),h?(0,t.jsx)("div",{className:"delete-options",children:(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"deleteOption",value:"template",checked:"template"===u,onChange:()=>p("template")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Delete this task"}),(0,t.jsx)("p",{className:"option-description",children:"Remove the task completely (one-off tasks are deleted entirely)"})]})]})}):(0,t.jsxs)("div",{className:"delete-options",children:[(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"deleteOption",value:"instance",checked:"instance"===u,onChange:()=>p("instance")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Delete just this occurrence"}),(0,t.jsx)("p",{className:"option-description",children:"Remove only this instance. Future occurrences will still be generated."})]})]}),(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"deleteOption",value:"future",checked:"future"===u,onChange:()=>p("future")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Delete all future occurrences"}),(0,t.jsx)("p",{className:"option-description",children:"Stop generating new instances, but keep past completed instances."})]})]}),(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"deleteOption",value:"template",checked:"template"===u,onChange:()=>p("template")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Delete task template entirely"}),(0,t.jsx)("p",{className:"option-description",children:"Remove the task completely for all children and all dates (past and future)."})]})]})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{s(u),a()},children:"Delete"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:a,children:"Cancel"})]})]})});return(0,o.createPortal)(f,document.body)}function c(e){let{open:n,onClose:a,onConfirm:s,task:i,taskTitle:d}=e,[r,c]=(0,l.useState)(!1),[u,p]=(0,l.useState)("instance");if((0,l.useEffect)(()=>(c(!0),()=>c(!1)),[]),(0,l.useEffect)(()=>{n&&i&&("oneoff"===i.type?p("template"):p("instance"))},[n,i]),!n||!r||!i)return null;let h="oneoff"===i.type||i.oneOff,m=d||i.title||"Task",f=(0,t.jsx)("div",{className:"modal-overlay",onClick:a,children:(0,t.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h2",{children:"Edit Task"}),(0,t.jsx)("span",{className:"close",onClick:e=>{e.stopPropagation(),a()},children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("p",{children:["What would you like to edit for ",(0,t.jsx)("strong",{children:m}),"?"]}),h?(0,t.jsx)("div",{className:"delete-options",children:(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"editOption",value:"template",checked:"template"===u,onChange:()=>p("template")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Edit this task"}),(0,t.jsx)("p",{className:"option-description",children:"Modify the task completely (one-off tasks are edited entirely)"})]})]})}):(0,t.jsxs)("div",{className:"delete-options",children:[(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"editOption",value:"instance",checked:"instance"===u,onChange:()=>p("instance")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Edit just this occurrence"}),(0,t.jsx)("p",{className:"option-description",children:"Modify only this instance. Future occurrences will remain unchanged."})]})]}),(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"editOption",value:"future",checked:"future"===u,onChange:()=>p("future")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Edit all future occurrences"}),(0,t.jsx)("p",{className:"option-description",children:"Apply changes to all future instances, but keep past instances unchanged."})]})]}),(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"editOption",value:"template",checked:"template"===u,onChange:()=>p("template")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Edit task template entirely"}),(0,t.jsx)("p",{className:"option-description",children:"Modify the task template, affecting all instances (past and future)."})]})]})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{s(u),a()},children:"Continue"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:a,children:"Cancel"})]})]})});return(0,o.createPortal)(f,document.body)}function u(e){let{startedAt:n,allowedSeconds:a,size:s=32}=e,[i,d]=l.default.useState(()=>Date.now());l.default.useEffect(()=>{let e=setInterval(()=>d(Date.now()),1e3);return()=>clearInterval(e)},[]);let o=Math.max(0,Math.floor((i-new Date(n).getTime())/1e3)),r=(s-4)/2,c=2*Math.PI*r,u=c*Math.min(Math.max(o/a,0),1),p=o>a?Math.min((o-a)/a,1):0,h=c*p;return(0,t.jsx)("div",{style:{width:s,height:s,display:"inline-block"},"aria-hidden":!0,children:(0,t.jsx)("svg",{width:s,height:s,viewBox:"0 0 ".concat(s," ").concat(s),children:(0,t.jsxs)("g",{transform:"translate(".concat(s/2,", ").concat(s/2,")"),children:[(0,t.jsx)("circle",{r:r,cx:0,cy:0,fill:"none",stroke:"#eef2ff",strokeWidth:3}),(0,t.jsx)("circle",{r:r,cx:0,cy:0,fill:"none",stroke:"#3b82f6",strokeWidth:3,strokeLinecap:"round",strokeDasharray:"".concat(u," ").concat(c-u),transform:"rotate(-90)"}),p>0&&(0,t.jsx)("circle",{r:r,cx:0,cy:0,fill:"none",stroke:"#ef4444",strokeWidth:3,strokeLinecap:"round",strokeDasharray:"".concat(h," ").concat(c-h),transform:"scale(-1,1) rotate(-90)"}),(0,t.jsx)("text",{x:0,y:4,textAnchor:"middle",fontSize:10,fill:p>0?"#ef4444":"#1f2937",style:{fontFamily:"monospace"},children:function(e){let t=Math.abs(Math.round(e)),n=Math.floor(t/60).toString().padStart(2,"0"),l=(t%60).toString().padStart(2,"0");return"".concat(e<0?"-":"").concat(n,":").concat(l)}(a-o)})]})})})}let p=function(e,t){let{state:n,dispatch:s}=(0,a.useChoresApp)(),i=(0,l.useMemo)(()=>{if(!e||!n.timers)return;let l=Object.values(n.timers).find(n=>n.taskKey===e&&n.childId===t);return l?{id:l.id,taskKey:l.taskKey,childId:l.childId,startedAt:l.startedAt,allowedSeconds:l.allowedSeconds}:void 0},[n.timers,e,t]),d=(0,l.useCallback)(()=>{if(!e||null==t)return;if(i)return void s({type:"START_TIMER",payload:{timer:{id:"t_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,8)),taskKey:e,childId:t,startedAt:new Date().toISOString(),allowedSeconds:i.allowedSeconds}}});let l=300;if(e.includes(":"));else{let t=e.split("-");if(t.length>=2){var a;let e=t.length>=5?t.slice(1,-3).join("-"):t.slice(1).join("-"),s=n.tasks.find(t=>t.id===e);(null==s||null==(a=s.timed)?void 0:a.allowedSeconds)&&(l=s.timed.allowedSeconds)}}s({type:"START_TIMER",payload:{timer:{id:"t_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,8)),taskKey:e,childId:t,startedAt:new Date().toISOString(),allowedSeconds:l}}})},[e,t,s,i,n.tasks]),o=(0,l.useCallback)(()=>{i&&s({type:"STOP_TIMER",payload:{timerId:i.id,stoppedAt:new Date().toISOString()}})},[i,s]),r=(0,l.useMemo)(()=>{if(!i)return!1;let e=new Date(i.startedAt).getTime();return Date.now()-e>=6e4},[i]);return{activeTimer:i,start:d,stop:o,canStopNow:r}};function h(e){let t=e||new Date,n=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(l,"-").concat(a)}function m(e){var n,o,m,f;let{task:g,instance:x,childId:v}=e,{state:j,dispatch:y}=(0,a.useChoresApp)(),{openTaskEditModal:N}=(0,s.useModalControl)(),[b,k]=l.default.useState(!1),[S,C]=l.default.useState(!0),[I,T]=l.default.useState(null),[w,D]=l.default.useState(!1),[E,A]=l.default.useState(!1),[O,_]=l.default.useState(!1),P=x||g.instance,R=function(e,t){var n;let l=h(),a=e.taskKey||"".concat(t,"-").concat(e.id,"-").concat(l);return{...e,id:e.id,title:e.title,emoji:e.emoji||"",color:e.color||"#ccc",stars:e.stars||0,money:e.money||0,isCompleted:!!e.isCompleted,taskKey:a,type:e.type,timedAllowedSeconds:null==(n=e.timed)?void 0:n.allowedSeconds,pendingCompletionId:e.pendingCompletionId,pendingCompletion:e.pendingCompletion}}(g,v),M=h(),L=(null==P?void 0:P.date)||M,K=R.taskKey||"".concat(v,"-").concat(R.id,"-").concat(L),F=P?P.completed:R.isCompleted,{activeTimer:U,start:B,stop:W,canStopNow:H}=p(K,v),q=l.default.useMemo(()=>{if(R.pendingCompletionId&&R.pendingCompletion)return R.pendingCompletion;let e=(j.timedCompletions||[]).find(e=>e.taskKey===K&&e.childId===v&&!e.approved);return!e&&R.id&&(e=(j.timedCompletions||[]).find(e=>{let t=e.taskKey.split("-");if(t.length>=5){let n=t.slice(1,-3).join("-"),l=t.slice(-3).join("-");return n===R.id&&l===L&&e.childId===v&&!e.approved}return!1})),e},[j.timedCompletions,K,v,R.pendingCompletionId,R.pendingCompletion,R.id,L]),z=R.pendingCompletionId||(null==q?void 0:q.id),J=()=>{if(P){var e,t;y({type:"COMPLETE_TASK_INSTANCE",payload:{instanceId:P.id,childId:v,starReward:Number((null!=(e=P.stars)?e:R.stars)||0),moneyReward:Number((null!=(t=P.money)?t:R.money)||0)}})}else y({type:"COMPLETE_TASK",payload:{taskKey:K,childId:v,starReward:Number(R.stars||0),moneyReward:Number(R.money||0)}})},{emoji:V,title:X,color:Y}=R,$=null!=(o=null!=(n=null==P?void 0:P.stars)?n:R.stars)?o:0,G=null!=(f=null!=(m=null==P?void 0:P.money)?m:R.money)?f:0;return(0,t.jsxs)("div",{className:"task-item".concat(F?" completed":""),style:{borderColor:Y},draggable:!F,onDragStart:e=>{let t=(null==P?void 0:P.date)||h();e.dataTransfer.setData("text/plain",JSON.stringify({taskId:R.id,taskKey:R.taskKey,sourceChildId:v,taskType:R.type,instanceDate:t})),e.dataTransfer.effectAllowed="move",e.stopPropagation()},"data-task-id":R.id,children:[!F&&(0,t.jsx)("span",{className:"drag-handle",children:"â‹®â‹®"}),(0,t.jsxs)("div",{className:"task-info",children:[(0,t.jsx)("span",{className:"task-emoji",children:V}),U&&(0,t.jsx)("div",{style:{marginLeft:8},children:(0,t.jsx)(u,{startedAt:U.startedAt,allowedSeconds:U.allowedSeconds,size:36})}),(0,t.jsxs)("div",{className:"task-details",children:[(0,t.jsx)("div",{className:"task-name",children:X}),(0,t.jsxs)("div",{className:"task-reward",children:[(0,t.jsxs)("span",{children:["â­ ",Number($)]}),(0,t.jsxs)("span",{children:["ðŸ’° $",Number(G).toFixed(2)]})]})]})]}),(0,t.jsxs)("div",{className:"task-actions",children:[R.timed||"number"==typeof R.timedAllowedSeconds?z?(0,t.jsxs)("div",{className:"pending-actions",children:[(0,t.jsx)("span",{className:"pending-label",children:"Pending approval"}),(0,t.jsx)("button",{className:"approve-btn",onClick:()=>{z&&(T(z),C(!0),k(!0))},children:"Approve"}),(0,t.jsx)("button",{className:"forgive-btn",onClick:()=>{z&&(T(z),C(!1),k(!0))},children:"Forgive"})]}):U?(0,t.jsx)("button",{className:"complete-btn",onClick:()=>W(),disabled:!H,children:"Stop"}):(0,t.jsx)("button",{className:"complete-btn",onClick:()=>B(),disabled:F,children:"Start"}):(0,t.jsx)("button",{className:"complete-btn",onClick:()=>{if(R.timed||"number"==typeof R.timedAllowedSeconds)return;let e=h(),t=((null==P?void 0:P.date)||e)>e?j.parentSettings.approvals.earlyComplete:j.parentSettings.approvals.taskComplete,n=j.parentSettings.pins||[];if(t)return 0===n.length?void _(!0):(T((null==P?void 0:P.id)||K||""),void k(!0));J()},disabled:F,children:F?"âœ“ Done":"Complete"}),(0,t.jsxs)("button",{className:"btn-icon-text btn-edit",onClick:()=>{A(!0)},title:"Edit task",children:[(0,t.jsx)("span",{className:"btn-icon",children:"âœï¸"}),(0,t.jsx)("span",{className:"btn-text",children:"Edit"})]}),(0,t.jsxs)("button",{className:"btn-icon-text btn-danger",onClick:()=>{D(!0)},title:"Delete task",children:[(0,t.jsx)("span",{className:"btn-icon",children:"ðŸ—‘ï¸"}),(0,t.jsx)("span",{className:"btn-text",children:"Delete"})]}),(0,t.jsx)(i.default,{open:b,onClose:()=>{k(!1),T(null)},onSuccess:e=>{k(!1),I&&z?(y({type:"APPROVE_TIMED_COMPLETION",payload:{completionId:I,approve:!0,applyMoney:S,actorHandle:e}}),T(null)):J()},message:I&&z?S?"Approve this timed completion?":"Forgive money for this timed completion?":"Enter a parent PIN to complete this task."}),(0,t.jsx)(d.default,{open:O,onClose:()=>_(!1),title:"Approval Required",message:(()=>{let e=h();return((null==P?void 0:P.date)||e)>e?"Early task completion requires parent approval, but no approvers are defined. Please add an approver in Settings first.":"Task completion requires parent approval, but no approvers are defined. Please add an approver in Settings first."})()}),(0,t.jsx)(c,{open:E,onClose:()=>A(!1),onConfirm:e=>{A(!1),N(R.id,e,null==P?void 0:P.id)},task:R,taskTitle:R.title}),(0,t.jsx)(r,{open:w,onClose:()=>D(!1),onConfirm:e=>{let t=String(R.id),n=null==P?void 0:P.id,l=new Date().toISOString().split("T")[0];switch(e){case"instance":n&&y({type:"DELETE_TASK_INSTANCE",payload:n});break;case"future":y({type:"DISABLE_TASK_AFTER_DATE",payload:{taskId:t,date:l}}),n&&y({type:"DELETE_TASK_INSTANCE",payload:n});break;case"template":y({type:"DELETE_TASK",payload:t}),n&&y({type:"DELETE_TASK_INSTANCE",payload:n})}D(!1)},task:R,taskTitle:R.title})]})]})}function f(e){if(!Array.isArray(e))return;let t=e.map(e=>{let t="string"==typeof e?parseInt(e,10):e;return Number.isFinite(t)?Number(t):null}).filter(e=>"number"==typeof e&&!isNaN(e));if(0!==t.length)return Array.from(new Set(t))}function g(e,t){var n,l,a,s,i;let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return[];let o=function(e,t){var n,l;let a=f((null==(n=e.assignment)?void 0:n.childIds)||[])||f((null==(l=e.rotation)?void 0:l.assignedChildIds)||e.assignedChildIds||[])||(void 0!==e.assignedTo?f([e.assignedTo]):void 0);if(!a||0===a.length)return t;let s=t.filter(e=>a.includes(e.id));return s.length>0?s:t}(e,t);if(0===o.length)return[];let r=d.date||new Date().toISOString().split("T")[0],c=null==(n=e.assignment)?void 0:n.strategy;if("simultaneous"===c)return o.map(e=>({child:e}));if("random"===c){let t="".concat(e.id,"-").concat(r),n=0;for(let e=0;e<t.length;e+=1)n=31*n+t.charCodeAt(e)>>>0;let l=n%o.length;return[{child:o[l],rotationIndex:l}]}let u="round_robin"===c||"custom_sequence"===c?"round-robin":"single"===c?"single-child":void 0,p=null!=(s=null!=u?u:null==(l=e.rotation)?void 0:l.mode)?s:o.length>1?"round-robin":"single-child";if("simultaneous"===p)return o.map(e=>({child:e}));if("round-robin"===p){let t=function(e,t,n){var l,a,s,i,d,o,r;if(0===t)return 0;let c=(null==(l=e.assignment)?void 0:l.rotationStartDate)||(null==(a=e.rotation)?void 0:a.startDate)||e.createdAt;if(c){let e=new Date(c.split("T")[0]),l=Math.floor((Number(new Date(n))-Number(e))/864e5);if(Number.isFinite(l)){let e=l%t;return e<0?e+t:e}}return((null!=(r=null!=(o=null==(i=e.assignment)||null==(s=i.history)?void 0:s.lastRotationIndex)?o:null==(d=e.rotation)?void 0:d.lastRotationIndex)?r:-1)+1)%t}(e,o.length,r),n=null==(i=e.rotation)?void 0:i.rotationOrder;if(n&&n.length>0){let e=t%n.length,l=n[e],a=o.find(e=>e.id===l);if(a)return[{child:a,rotationIndex:e}]}return[{child:o[t],rotationIndex:t}]}if(e.assignedTo){let t=parseInt(e.assignedTo,10),n=o.find(e=>e.id===t);if(n)return[{child:n}]}if((null==(a=e.rotation)?void 0:a.assignedChildIds)&&e.rotation.assignedChildIds.length>0){let t=e.rotation.assignedChildIds[0],n=o.find(e=>e.id===t);if(n)return[{child:n}]}if(e.assignedChildIds&&e.assignedChildIds.length>0){let t=e.assignedChildIds[0],n=o.find(e=>e.id===t);if(n)return[{child:n}]}return[{child:o[0]}]}var x=e.i(83627);function v(e,t){if(e.schedule)return(0,x.doesScheduleRunOnDate)(e.schedule,null!=t?t:new Date().toISOString().split("T")[0]);if(!e.recurring)return!1;let n=t?new Date(t):new Date,l=n.getDay();switch(e.recurring.cadence||"daily"){case"daily":default:return!0;case"weekly":return l===(parseInt(e.id.replace(/\D/g,""))||0)%7;case"monthly":let a=new Date(n.getFullYear(),n.getMonth(),1),s=parseInt(e.id.replace(/\D/g,""))||0,i=new Date(a);return i.setDate(i.getDate()+(s%7-i.getDay()+7)%7),n.getDate()===i.getDate();case"weekdays":return l>=1&&l<=5;case"weekends":return 0===l||6===l;case"custom-days":var d;return(null==(d=e.recurring.customDays)?void 0:d.includes(l))||!1}}function j(e,t,n,l){let a=[],s={},i=n.split("T")[0];return e.forEach(e=>{if(!1===e.enabled||e.disabledAfter&&i>e.disabledAfter)return;let n=g(e,t,{date:i});n&&0!==n.length&&function(e,t){if(e.schedule)return v(e,t);if("oneoff"===e.type){var n,l;return(null==(l=e.oneOff)||null==(n=l.dueDate)?void 0:n.split("T")[0])===t}return e.recurring||"recurring"===e.type?v(e,t):!!e.timed&&(!e.recurring||v(e,t))}(e,i)&&n.forEach(t=>{let{child:n,rotationIndex:d}=t;if(l.some(t=>t.templateId===e.id&&t.date===i&&t.childId===n.id))return;let o=function(e,t){var n,l,a,s,i,d;let o=(null==(n=e.schedule)?void 0:n.dueTime)||(null==(a=e.schedule)||null==(l=a.rule)?void 0:l.startTime)||(null==(i=e.schedule)||null==(s=i.rule)?void 0:s.timeOfDay)||(null==(d=e.recurring)?void 0:d.timeOfDay);if(!o)return;let[r,c]=o.split(":").map(e=>parseInt(e,10));if(isNaN(r)||isNaN(c))return;let u=function(e){let[t,n,l]=e.split("-").map(Number);return new Date(t,n-1,l)}(t);return u.setHours(r,c,0,0),u.toISOString()}(e,i);if(a.push({id:"instance_".concat(e.id,"_").concat(n.id,"_").concat(i),templateId:e.id,childId:n.id,date:i,dueAt:o,stars:e.stars,money:e.money,rotationIndex:d,completed:!1,createdAt:new Date().toISOString()}),"number"==typeof d){var r,c,u,p,h,m,f,g,x,v,j,y,N,b;let t=e.assignment,l=(null==t?void 0:t.childIds)||(null==(r=e.rotation)?void 0:r.assignedChildIds)||e.assignedChildIds||[n.id],a={...(null==t?void 0:t.history)||(null==(c=e.rotation)?void 0:c.history)||{},lastRotationIndex:d,lastAssignedChildId:n.id,lastAssignedDate:i};s[e.id]={rotation:{mode:null!=(g=null==(u=e.rotation)?void 0:u.mode)?g:"round-robin",assignedChildIds:l,lastRotationIndex:d,lastAssignedChildId:n.id,startDate:null!=(v=null!=(x=null==(p=e.rotation)?void 0:p.startDate)?x:null==t?void 0:t.rotationStartDate)?v:e.createdAt,history:a,allowSimultaneous:null!=(j=null==(h=e.rotation)?void 0:h.allowSimultaneous)?j:null==t?void 0:t.allowSimultaneous,groupId:null!=(y=null==(m=e.rotation)?void 0:m.groupId)?y:null==t?void 0:t.groupId},assignment:t?{...t,childIds:l,rotationStartDate:null!=(b=null!=(N=t.rotationStartDate)?N:null==(f=e.rotation)?void 0:f.startDate)?b:e.createdAt,history:a}:void 0}}})}),{instances:a,rotationStates:Object.entries(s).map(e=>{let[t,n]=e;return{taskId:t,rotation:n.rotation,assignment:n.assignment}})}}var y=e.i(55474),N=e.i(51575),b=e.i(8430),k=e.i(18994),S=e.i(41943);let C=["function transfer(address to, uint256 amount) returns (bool)","function decimals() view returns (uint8)","function symbol() view returns (string)"];function I(e){let{open:n,onClose:a,child:s,defaultAmount:i=0}=e,{address:d}=(0,N.useAccount)(),{connectAsync:o}=(0,N.useConnect)(),{chain:r}=(0,N.useNetwork)(),{switchNetwork:c}=(0,N.useSwitchNetwork)(),{data:u}=(0,N.useWalletClient)(),[p,h]=l.default.useState(null),[m,f]=l.default.useState(i?String(i):"0.01"),[g,x]=l.default.useState("ETH"),[v,j]=l.default.useState(null),[y,I]=l.default.useState(1);l.default.useEffect(()=>{n||(j(null),f(i?String(i):"0.01"))},[n,i]);let T=async()=>{try{var e;if(!window.ethereum)return void j("No web3 wallet found");let t=await o({connector:new b.InjectedConnector}),n=(null==t?void 0:t.account)||d;n&&h(String(n)),I((null==t||null==(e=t.chain)?void 0:e.id)||(null==r?void 0:r.id)||1),j("Connected: "+(n||""))}catch(e){j("Connect error: "+String((null==e?void 0:e.message)||String(e)))}},w=async e=>{if(!window.ethereum)return j("No wallet");try{if(c)c(e),j("Switched network"),I(e);else{let t=window.ethereum;t.request&&await t.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x"+e.toString(16)}]}),j("Switched network"),I(e)}}catch(e){j("Switch error: "+String((null==e?void 0:e.message)||String(e)))}},D=async()=>{if(!u)return j("Please connect your wallet first");if(!s.blockchainAddress)return j("Child has no blockchain address set in Settings");try{if(j("Preparing transaction..."),"ETH"===g){let e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"wei";return(0,S.parseUnits)(e,k.etherUnits[t])}(m||"0");if(!(null==u?void 0:u.sendTransaction))return j("Wallet client can't send transactions");let t=await u.sendTransaction({to:s.blockchainAddress,value:e});j("Sent. Transaction hash: "+String(t))}else{let e={1:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",42161:"0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8",8453:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913"}[y];if(!e)return j("USDC not configured for this network");let t=(0,S.parseUnits)(m||"0",6);if(!(null==u?void 0:u.writeContract))return j("Wallet client can't write contracts");let n=await u.writeContract({address:e,abi:C,functionName:"transfer",args:[s.blockchainAddress,t]});j("USDC transfer submitted: "+String(n))}}catch(e){j("Send error: "+String((null==e?void 0:e.message)||String(e)))}};return n?(0,t.jsx)("div",{className:"modal-overlay",onClick:a,children:(0,t.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsxs)("h2",{children:["Pay ",s.name," On-Chain"]}),(0,t.jsx)("span",{className:"close",onClick:e=>{e.stopPropagation(),a()},children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("label",{children:"Child address / ENS:"}),(0,t.jsx)("div",{children:s.blockchainAddress||(0,t.jsx)("em",{children:"Not set"})})]}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("label",{children:"Token:"}),(0,t.jsxs)("select",{value:g,onChange:e=>x(e.target.value),children:[(0,t.jsx)("option",{value:"ETH",children:"ETH"}),(0,t.jsx)("option",{value:"USDC",children:"USDC"})]})]}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsxs)("label",{children:["Amount (","ETH"===g?"ETH":"USDC","):"]}),(0,t.jsx)("input",{value:m,onChange:e=>f(e.target.value),placeholder:"0.01"})]}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("label",{children:"Network:"}),(0,t.jsxs)("select",{value:y,onChange:e=>w(Number(e.target.value)),children:[(0,t.jsx)("option",{value:1,children:"Ethereum Mainnet"}),(0,t.jsx)("option",{value:42161,children:"Arbitrum One"}),(0,t.jsx)("option",{value:8453,children:"Base"})]})]}),(0,t.jsx)("div",{className:"input-group",children:p?(0,t.jsxs)("div",{style:{padding:"8px",background:"#f7fafc",borderRadius:"4px"},children:["Connected: ",p]}):(0,t.jsx)("button",{className:"btn btn-primary",onClick:T,children:"Connect Wallet"})}),v&&(0,t.jsx)("div",{className:"error-message",style:{marginTop:"12px",background:v.includes("error")||v.includes("error")?"#fed7d7":"#d1fae5",color:v.includes("error")||v.includes("error")?"#c53030":"#065f46"},children:v})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:D,children:"Send Payment"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:a,children:"Cancel"})]})]})}):null}function T(e){let{open:n,onClose:s,childId:i}=e,{state:d}=(0,a.useChoresApp)(),[r,c]=(0,l.useState)(!1);if((0,l.useEffect)(()=>(c(!0),()=>c(!1)),[]),!n||!r)return null;let u=(d.actionLog||[]).filter(e=>{if(!i)return!0;let t=e.payload;return!!t&&"object"==typeof t&&(t.childId===i||t.child&&"object"==typeof t.child&&null!==t.child&&t.child.id===i||t.task&&"object"==typeof t.task&&null!==t.task&&t.task.childId===i)}).slice().reverse(),p=u.slice(0,50),h=u.slice(0,100),m=(0,t.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,t.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsxs)("h2",{children:["Action Log ",i?"for child ".concat(i):""]}),(0,t.jsx)("span",{className:"close",onClick:e=>{e.stopPropagation(),s()},children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",style:{maxHeight:"50vh",overflow:"auto"},children:[0===p.length&&(0,t.jsx)("div",{style:{textAlign:"center",color:"#666",padding:"20px"},children:"No recent actions"}),p.map(e=>(0,t.jsxs)("div",{style:{borderBottom:"1px solid #e2e8f0",padding:"12px",marginBottom:"8px"},children:[(0,t.jsx)("div",{style:{fontSize:"0.75rem",color:"#666",marginBottom:"4px"},children:new Date(e.timestamp).toLocaleString()}),(0,t.jsx)("div",{style:{fontWeight:600,marginBottom:"4px",color:"#1a202c"},children:e.actionType}),e.actorHandle&&(0,t.jsxs)("div",{style:{fontSize:"0.75rem",color:"#4a5568",marginBottom:"4px",fontStyle:"italic"},children:["Approved by: ",e.actorHandle]}),(0,t.jsx)("pre",{style:{whiteSpace:"pre-wrap",fontSize:"0.7rem",background:"#f7fafc",padding:"8px",borderRadius:"4px",overflow:"auto",maxHeight:"200px"},children:JSON.stringify(e.payload||{},null,2)})]},e.id))]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{let e=new Blob([JSON.stringify({entries:h,exportedAt:new Date().toISOString(),totalEntries:h.length,filteredByChildId:i||null},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="action-log-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},children:"Export JSON (last 100)"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:()=>{let e=new Blob([["id,actionType,actorHandle,timestamp,payload",...h.map(e=>[e.id,e.actionType,e.actorHandle||"",e.timestamp,JSON.stringify(e.payload||{})]).map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(","))].join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="action-log-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},children:"Export CSV (last 100)"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:s,children:"Close"})]})]})});return(0,o.createPortal)(m,document.body)}function w(e){let{open:n,onClose:a,onConfirm:s,task:i,taskTitle:d,targetChildName:r}=e,[c,u]=(0,l.useState)(!1),[p,h]=(0,l.useState)("instance");if((0,l.useEffect)(()=>(u(!0),()=>u(!1)),[]),(0,l.useEffect)(()=>{n&&i&&h("instance")},[n,i]),!n||!c||!i)return null;let m=d||i.title||"Task",f=(0,t.jsx)("div",{className:"modal-overlay",onClick:a,children:(0,t.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h2",{children:"Move Task"}),(0,t.jsx)("span",{className:"close",onClick:e=>{e.stopPropagation(),a()},children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("p",{children:["This task rotates across children. How would you like to move ",(0,t.jsx)("strong",{children:m})," to ",r||"this child","?"]}),(0,t.jsxs)("div",{className:"delete-options",children:[(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"dragDropOption",value:"instance",checked:"instance"===p,onChange:()=>h("instance")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Move just this occurrence"}),(0,t.jsx)("p",{className:"option-description",children:"Move only this instance. Future rotations will continue as scheduled."})]})]}),(0,t.jsxs)("label",{className:"delete-option",children:[(0,t.jsx)("input",{type:"radio",name:"dragDropOption",value:"redo-rotations",checked:"redo-rotations"===p,onChange:()=>h("redo-rotations")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Redo all future rotations"}),(0,t.jsx)("p",{className:"option-description",children:"Update the rotation to start from today with this child, and regenerate all future assignments."})]})]})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{s(p),a()},children:"Move"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:a,children:"Cancel"})]})]})});return(0,o.createPortal)(f,document.body)}function D(e){var n,o;let{child:c,onAddTask:u}=e,{state:p,dispatch:f}=(0,a.useChoresApp)(),{openEditChildModal:v,openTaskEditModal:N}=(0,s.useModalControl)(),[b,k]=l.default.useState(!1),[S,C]=l.default.useState(!1),[D,E]=l.default.useState(!1),[A,O]=l.default.useState(!1),[_,P]=l.default.useState(!1),[R,M]=l.default.useState(!1),[L,K]=l.default.useState(!1),[F,U]=l.default.useState(null),[B,W]=l.default.useState(!1),[H,q]=l.default.useState(null),[z,J]=l.default.useState(!1),[V,X]=l.default.useState(null),[Y,$]=l.default.useState(!1),[G,Q]=l.default.useState(null),[Z,ee]=l.default.useState(!1),et=(e,t)=>{let n=(p.taskInstances||[]).find(n=>n.templateId===e.id&&n.date===t.split("T")[0]);if(n)f({type:"UPDATE_TASK_INSTANCE",payload:{...n,childId:c.id}});else{let n=t.split("T")[0],{instances:l}=j([e],p.children,n,p.taskInstances||[]),a=l.find(t=>t.templateId===e.id&&t.date===n);a&&f({type:"ADD_TASK_INSTANCE",payload:{...a,childId:c.id}})}},en=h(),el=function(e,t,n){let l=n.split("T")[0];return e.filter(e=>e.childId===t&&e.date===l)}(p.taskInstances||[],c.id,en),ea=[],es=[];el.forEach(e=>{var t;let n=p.tasks.find(t=>t.id===e.templateId);if(!n)return;let l="".concat(e.childId,"-").concat(e.templateId,"-").concat(e.date),a=e.completed,s=(p.timedCompletions||[]).find(t=>t.taskKey===l&&t.childId===e.childId&&!t.approved),i={...n,instance:e,taskKey:l,isCompleted:a,pendingCompletionId:null==s?void 0:s.id,pendingCompletion:s};if("oneoff"===n.type||n.oneOff){let e=null==(t=n.oneOff)?void 0:t.dueDate;e&&e.split("T")[0]===en?ea.push(i):es.push(i)}else ea.push(i)});let[ei,ed]=(0,l.useState)(!1);(0,l.useEffect)(()=>{ed(!0)},[]);let[eo,er]=(0,l.useState)(!1),ec=(0,l.useMemo)(()=>{if(!ei)return[];let e=[],t=new Date(en);t.setDate(t.getDate()+7);let n=h(t);p.tasks.forEach(t=>{t.enabled&&t.schedule&&0!==(t.assignedChildIds||[]).length&&(0,x.getNextExecutionDateTimes)(t.schedule,en,20).forEach(l=>{let a=l.split("T")[0];a!==en&&!(a>n)&&g(t,p.children,{date:a}).some(e=>e.child.id===c.id)&&e.push({task:t,dateTime:l,date:a})})});let l=e.sort((e,t)=>new Date(e.dateTime).getTime()-new Date(t.dateTime).getTime());return eo?l:l.slice(0,5)},[p.tasks,p.children,c.id,en,ei,eo]),eu=(0,l.useMemo)(()=>{if(!ei)return!1;let e=new Date(en);e.setDate(e.getDate()+7);let t=h(e),n=0;return p.tasks.forEach(e=>{e.enabled&&e.schedule&&0!==(e.assignedChildIds||[]).length&&(0,x.getNextExecutionDateTimes)(e.schedule,en,20).forEach(l=>{let a=l.split("T")[0];a!==en&&!(a>t)&&g(e,p.children,{date:a}).some(e=>e.child.id===c.id)&&n++})}),n>5},[p.tasks,p.children,c.id,en,ei]);return(0,t.jsxs)("div",{className:"child-column".concat(D?" drag-over":""),"data-child-id":c.id,onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",E(!0)},onDragLeave:()=>{E(!1)},onDrop:e=>{e.preventDefault(),E(!1);let t=e.dataTransfer.getData("text/plain");if(!t.startsWith("child-"))try{var n;let{taskId:e,sourceChildId:l,instanceDate:a}=JSON.parse(t);if(l===c.id)return;let s=p.tasks.find(t=>t.id===e);if(!s)return;let i=p.parentSettings.approvals.taskMove,d=p.parentSettings.pins||[];if(i){if(0===d.length)return void ee(!0);q({task:s,instanceDate:a||h()}),M(!0);return}(null==(n=s.rotation)?void 0:n.mode)==="round-robin"?(q({task:s,instanceDate:a||h()}),W(!0)):et(s,a||h())}catch(e){console.error("Drop error:",e)}},children:[D&&(0,t.jsx)("div",{className:"drop-indicator",children:"Drop task here"}),(0,t.jsxs)("div",{className:"child-header",children:[(0,t.jsxs)("div",{className:"child-name-row",children:[(0,t.jsx)("span",{className:"child-name",children:c.name}),(0,t.jsxs)("div",{className:"child-header-actions",children:[(0,t.jsxs)("button",{className:"btn-icon-text",onClick:()=>v(c.id),title:"Edit child",children:[(0,t.jsx)("span",{className:"btn-icon",children:"âœï¸"}),(0,t.jsx)("span",{className:"btn-text",children:"Edit"})]}),(0,t.jsxs)("button",{className:"btn-icon-text",onClick:()=>{if(0>=(c.money||0))return void O(!0);P(!0)},title:"Pay out cash",children:[(0,t.jsx)("span",{className:"btn-icon",children:"ðŸ’µ"}),(0,t.jsx)("span",{className:"btn-text",children:"Pay"})]}),(0,t.jsxs)("button",{className:"btn-icon-text",onClick:()=>{k(!0)},title:"Pay on blockchain",children:[(0,t.jsx)("span",{className:"btn-icon",children:"ðŸŒ"}),(0,t.jsx)("span",{className:"btn-text",children:"Wallet"})]}),(0,t.jsxs)("button",{className:"btn-icon-text",onClick:()=>C(!0),title:"View action log",children:[(0,t.jsx)("span",{className:"btn-icon",children:"ðŸ“"}),(0,t.jsx)("span",{className:"btn-text",children:"Log"})]})]})]}),(0,t.jsxs)("div",{className:"child-stats",children:[(0,t.jsxs)("div",{className:"stat-item",children:[(0,t.jsx)("span",{children:"â­"}),(0,t.jsx)("span",{children:null!=(n=c.stars)?n:0})]}),(0,t.jsxs)("div",{className:"stat-item",children:[(0,t.jsx)("span",{children:"ðŸ’°"}),(0,t.jsxs)("span",{children:["$",(null!=(o=c.money)?o:0).toFixed(2)]})]})]})]}),(0,t.jsxs)("div",{className:"tasks-list",children:[(0,t.jsxs)("div",{className:"tasks-section",children:[(0,t.jsxs)("div",{className:"section-title",children:["Today's Tasks",(0,t.jsx)("button",{className:"add-task-btn",onClick:u,children:"+ Task"})]}),0===ea.length?(0,t.jsx)("div",{className:"empty-state",children:"No tasks for today"}):(0,t.jsx)(t.Fragment,{children:ea.map(e=>{let n=e.instance.id;return(0,t.jsx)(m,{task:e,instance:e.instance,childId:c.id},n)})})]}),es.length>0&&(0,t.jsxs)("div",{className:"tasks-section inactive-tasks",children:[(0,t.jsx)("div",{className:"section-title",children:"Upcoming Tasks"}),(0,t.jsx)(t.Fragment,{children:es.map(e=>{let n=e.instance.id;return(0,t.jsx)(m,{task:e,instance:e.instance,childId:c.id},n)})})]}),ec.length>0&&(0,t.jsxs)("div",{className:"tasks-section upcoming-scheduled",children:[(0,t.jsx)("div",{className:"section-title",children:"Scheduled"}),(0,t.jsx)(t.Fragment,{children:ec.map(e=>{let{task:n,dateTime:l,date:a}=e,s=(p.taskInstances||[]).find(e=>e.templateId===n.id&&e.childId===c.id&&e.date===a),i={...n,instance:s,taskKey:s?"".concat(s.childId,"-").concat(s.templateId,"-").concat(s.date):"".concat(c.id,"-").concat(n.id,"-").concat(a),isCompleted:(null==s?void 0:s.completed)||!1},d=(null==s?void 0:s.id)||"".concat(n.id,"-").concat(l);return(0,t.jsx)(m,{task:i,instance:s,childId:c.id},d)})}),eu&&!eo&&(0,t.jsxs)("button",{className:"see-more-btn",onClick:()=>er(!0),children:["See more (",ec.length," shown)"]}),eo&&eu&&(0,t.jsx)("button",{className:"see-more-btn",onClick:()=>er(!1),children:"Show less"})]})]}),b&&(0,t.jsx)(I,{open:b,onClose:()=>k(!1),child:c,defaultAmount:c.money||0}),S&&(0,t.jsx)(T,{open:S,onClose:()=>C(!1),childId:c.id}),(0,t.jsx)(d.default,{open:A,onClose:()=>O(!1),title:"Cannot Pay Out",message:"".concat(c.name," has no money to pay out.")}),(0,t.jsx)(d.default,{open:L,onClose:()=>K(!1),title:"Approval Required",message:"Early completion requires parent approval, but no approvers are defined. Please add an approver in Settings first."}),(0,t.jsx)(i.default,{open:R,onClose:()=>{M(!1),U(null),q(null),X(null),Q(null)},onSuccess:e=>{if(M(!1),F)((e,t)=>{var n,l,a,s,i,d,o,r;let u=(p.taskInstances||[]).find(n=>n.templateId===e.id&&n.childId===c.id&&n.date===t);if(u)u.completed||f({type:"COMPLETE_TASK_INSTANCE",payload:{instanceId:u.id,childId:c.id,starReward:Number(null!=(l=null!=(n=u.stars)?n:e.stars)?l:0),moneyReward:Number(null!=(s=null!=(a=u.money)?a:e.money)?s:0)}});else{let{instances:n}=j([e],p.children,t,p.taskInstances||[]),l=n.find(n=>n.templateId===e.id&&n.childId===c.id&&n.date===t);l&&(f({type:"ADD_TASK_INSTANCE",payload:l}),f({type:"COMPLETE_TASK_INSTANCE",payload:{instanceId:l.id,childId:c.id,starReward:Number(null!=(d=null!=(i=l.stars)?i:e.stars)?d:0),moneyReward:Number(null!=(r=null!=(o=l.money)?o:e.money)?r:0)}}))}})(F.task,F.date),U(null);else if(H){var t;let{task:e,instanceDate:n}=H;(null==(t=e.rotation)?void 0:t.mode)==="round-robin"?W(!0):(et(e,n),q(null))}else if(V&&G){let{task:e,date:t}=V,n=t.split("T")[0];"template"===G?f({type:"DELETE_TASK",payload:e.id}):f({type:"DISABLE_TASK_AFTER_DATE",payload:{taskId:e.id,date:n}}),X(null),Q(null)}},message:F?"Enter a parent PIN to approve completing this task early.":H?"Enter a parent PIN to approve moving this task.":V?"Enter a parent PIN to approve deleting or disabling this task.":"Enter a parent PIN."}),(0,t.jsx)(d.default,{open:Z,onClose:()=>ee(!1),title:"Approval Required",message:"Moving tasks requires parent approval, but no approvers are defined. Please add an approver in Settings first."}),(0,t.jsx)(d.default,{open:Y,onClose:()=>$(!1),title:"Approval Required",message:"Editing/deleting tasks requires parent approval, but no approvers are defined. Please add an approver in Settings first."}),(0,t.jsx)(r,{open:z,onClose:()=>{J(!1),X(null),Q(null)},onConfirm:e=>{var t,n,l;if(J(!1),!V)return;let a=!!(null==(n=p.parentSettings)||null==(t=n.approvals)?void 0:t.editTasks),s=(null==(l=p.parentSettings)?void 0:l.pins)||[];if(a)return 0===s.length?void $(!0):(Q(e),void M(!0));let{task:i,date:d}=V,o=d.split("T")[0];"template"===e?f({type:"DELETE_TASK",payload:i.id}):f({type:"DISABLE_TASK_AFTER_DATE",payload:{taskId:i.id,date:o}}),X(null),Q(null)},task:V?V.task:null,taskTitle:V?V.task.title||"Task":void 0}),(0,t.jsx)(y.default,{open:_,onClose:()=>P(!1),onConfirm:()=>{f({type:"PAY_CHILD",payload:c.id})},title:"Pay Out",message:"Pay ".concat(c.name," $").concat((c.money||0).toFixed(2),"?"),confirmText:"Pay",cancelText:"Cancel"}),(0,t.jsx)(w,{open:B,onClose:()=>{W(!1),q(null)},onConfirm:e=>{if(!H)return;let{task:t,instanceDate:n}=H;"instance"===e?et(t,n):"redo-rotations"===e&&(e=>{var t,n;let l=new Date,a=(null==(t=e.rotation)?void 0:t.assignedChildIds)||e.assignedChildIds||[],s=a.indexOf(c.id),i=s>=0?s:0,d=new Date(l);d.setDate(d.getDate()-i);let o=h(d);f({type:"UPDATE_TASK",payload:{...e,id:e.id,rotation:{...e.rotation,mode:(null==(n=e.rotation)?void 0:n.mode)||"round-robin",assignedChildIds:a.length>0?a:[c.id],startDate:o,lastAssignedChildId:c.id,lastRotationIndex:i}}})})(t),q(null)},task:(null==H?void 0:H.task)||null,targetChildName:c.name})]})}function E(e){let{childrenList:n,onAddTask:s}=e,{state:i,dispatch:d}=(0,a.useChoresApp)(),o=l.default.useRef(null),[r,c]=l.default.useState(null),u=h();(0,l.useEffect)(()=>{let{instances:e,rotationStates:t}=j(i.tasks,i.children,u,i.taskInstances||[]);e.length>0&&e.forEach(e=>{d({type:"ADD_TASK_INSTANCE",payload:e})}),t.length>0&&t.forEach(e=>{var t,n,l,a;let{taskId:s,rotation:o,assignment:r}=e,c=i.tasks.find(e=>e.id===s);if(!c)return;let u=c.rotation,p=c.assignment,h=!u||u.lastRotationIndex!==o.lastRotationIndex||u.lastAssignedChildId!==o.lastAssignedChildId,m=r&&(!p||(null==(t=p.history)?void 0:t.lastRotationIndex)!==(null==(n=r.history)?void 0:n.lastRotationIndex)||(null==(l=p.history)?void 0:l.lastAssignedChildId)!==(null==(a=r.history)?void 0:a.lastAssignedChildId));(h||m)&&d({type:"UPDATE_TASK",payload:{...c,rotation:o,assignment:null!=r?r:p}})})},[i.tasks.length,i.children.length,u]);let p=()=>{let e=o.current;if(!e)return;let t=e.scrollWidth>e.clientWidth,n=e.scrollLeft<=5,l=e.scrollLeft>=e.scrollWidth-e.clientWidth-5;e.classList.toggle("scrollable-left",t&&!n),e.classList.toggle("scrollable-right",t&&!l)};l.default.useEffect(()=>{let e=o.current;if(e)return p(),e.addEventListener("scroll",p),window.addEventListener("resize",p),()=>{e.removeEventListener("scroll",p),window.removeEventListener("resize",p)}},[n]);let m=e=>{null!==r&&(e.preventDefault(),e.dataTransfer.dropEffect="move")},f=()=>{c(null)};return(0,t.jsx)("div",{ref:o,className:"children-grid","data-child-count":n.length,onDragOver:m,children:0===n.length?(0,t.jsxs)("div",{className:"no-children-message",children:[(0,t.jsx)("h3",{children:"No children configured"}),(0,t.jsx)("p",{children:'Add children using the "+ Add Child" button to start managing chores.'})]}):n.map(e=>(0,t.jsx)("div",{draggable:!0,onDragStart:t=>((e,t)=>{let n=e.target;n.closest(".task-item")||n.closest("[data-task-id]")||(c(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain","child-".concat(t)))})(t,e.id),onDragOver:m,onDrop:t=>((e,t)=>{if(e.preventDefault(),!e.dataTransfer.getData("text/plain").startsWith("child-")||null===r||r===t)return void c(null);let n=i.parentSettings.childDisplayOrder||[],l=i.children.map(e=>e.id),a=[...n.filter(e=>l.includes(e)),...l.filter(e=>!n.includes(e))],s=a.indexOf(r),o=a.indexOf(t);if(-1===s||-1===o)return void c(null);let u=[...a];u.splice(s,1),u.splice(o,0,r),d({type:"UPDATE_PARENT_SETTINGS",payload:{childDisplayOrder:u}}),c(null)})(t,e.id),onDragEnd:f,style:{opacity:r===e.id?.5:1,cursor:"move"},children:(0,t.jsx)(D,{child:e,onAddTask:s?()=>s(e.id):void 0})},e.id))})}function A(){let{state:e}=(0,a.useChoresApp)(),{openOneOffTaskModal:i}=(0,s.useModalControl)(),[d,o]=(0,l.useState)(!1);(0,l.useEffect)(()=>{o(!0)},[]);let r=l.default.useMemo(()=>{let t=e.parentSettings.childDisplayOrder||[];if(0===t.length)return[...e.children].sort((e,t)=>e.id-t.id);let n=new Map(e.children.map(e=>[e.id,e])),l=[],a=[];return t.forEach(e=>{let t=n.get(e);t&&(l.push(t),n.delete(e))}),n.forEach(e=>a.push(e)),a.sort((e,t)=>e.id-t.id),[...l,...a]},[e.children,e.parentSettings.childDisplayOrder]);return d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.default,{children:(0,t.jsx)("title",{children:"Family Chores"})}),(0,t.jsx)("main",{className:"main-view",children:(0,t.jsx)(E,{childrenList:r,onAddTask:i})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.default,{children:(0,t.jsx)("title",{children:"Family Chores"})}),(0,t.jsx)("main",{className:"main-view",children:(0,t.jsx)("div",{className:"children-grid",children:(0,t.jsx)("div",{className:"empty-state",children:"Loading..."})})})]})}},19675,(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",()=>e.r(43181)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push(["/"])})}]);